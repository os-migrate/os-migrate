<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Changelog &mdash; os-migrate  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="OS Migrate Developer Documentation" href="devel/README.html" />
    <link rel="prev" title="Module - validate_resource_files" href="modules/module-validate_resource_files.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> os-migrate
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="user/README.html">OS Migrate User Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="roles.html">Documented roles in os-migrate</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Documented modules in os-migrate</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#unreleased">(unreleased)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#changes">Changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id1">0.17.0 (2024-04-17)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fix">Fix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id2">0.16.0 (2023-09-13)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#new">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Fix</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other">Other</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id4">0.15.1 (2023-06-06)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">Fix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id7">0.15.0 (2023-04-20)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id8">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">Fix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id10">0.14.0 (2022-09-22)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id11">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13">Fix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id14">0.13.0 (2022-03-30)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id15">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id16">Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id17">Fix</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id18">Other</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id19">0.12.0 (2021-11-19)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id20">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id21">Fix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id22">0.11.1 (2021-10-19)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id23">Fix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id24">0.11.0 (2021-10-08)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id25">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id26">Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id27">Fix</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id28">Other</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id29">0.10.1 (2021-09-02)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id30">Fix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id31">0.10.0 (2021-09-01)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id32">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id33">Fix</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id34">Other</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id35">0.9.0 (2021-07-08)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id36">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id37">Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id38">Fix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id39">0.8.4 (2021-06-16)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id40">Fix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id41">0.8.3 (2021-06-10)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id42">Fix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id43">0.8.2 (2021-05-25)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id44">Fix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id45">0.8.1 (2021-05-12)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id46">Fix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id47">0.8.0 (2021-04-23)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id48">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id49">Fix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id50">0.7.0 (2021-02-18)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id51">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id52">Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id53">Fix</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id54">Other</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id55">0.6.2 (2021-01-28)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id56">Fix</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id57">Other</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id58">0.6.1 (2020-12-10)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id59">0.6.0 (2020-11-25)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id60">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id61">Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id62">Fix</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id63">Other</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id64">0.5.0 (2020-10-02)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id65">0.4.1 (2020-06-26)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id66">0.4.0 (2020-06-26)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id67">0.3.1 (2020-06-05)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id68">0.3.0 (2020-06-02)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="devel/README.html">OS Migrate Developer Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">os-migrate</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Changelog</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/changelog.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="changelog">
<h1>Changelog<a class="headerlink" href="#changelog" title="Permalink to this heading"></a></h1>
<section id="unreleased">
<h2>(unreleased)<a class="headerlink" href="#unreleased" title="Permalink to this heading"></a></h2>
<section id="changes">
<h3>Changes<a class="headerlink" href="#changes" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Doc updates for package installations. [cloudguruab]</p></li>
</ul>
</section>
</section>
<section id="id1">
<h2>0.17.0 (2024-04-17)<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h2>
<section id="fix">
<h3>Fix<a class="headerlink" href="#fix" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Added mising network param for external network or nova pool name.
[cloudguruab]</p></li>
<li><p>Patch to storage migrations feature and docs. [cloudguruab]</p></li>
</ul>
</section>
</section>
<section id="id2">
<h2>0.16.0 (2023-09-13)<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h2>
<section id="new">
<h3>New<a class="headerlink" href="#new" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Documentation for new storage migration modes. [cloudguruab]</p></li>
<li><p>Strg migration. [cloudguruab]</p></li>
</ul>
</section>
<section id="id3">
<h3>Fix<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Defaulting to release zed for devstack. [cloudguruab]</p></li>
<li><p>Revert install guestfs-tools on CentOS 9 (#620) (#627) [Adrian Brown]</p></li>
<li><p>Set default username to centos (#625) [Nicholas]</p>
<p>change default username for CentOS 9 cloud image</p>
</li>
<li><p>Install guestfs-tools on CentOS 9 (#620) (#627) [Adrian Brown,
Nicholas Natale]</p>
<p>Change install content task on conversion hosts to install guestfs-tools for
CentOS 9 systems (guestfs-tools provides virt-sparsify)</p>
</li>
</ul>
</section>
<section id="other">
<h3>Other<a class="headerlink" href="#other" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Merge branch ‘main’ of <a class="reference external" href="https://github.com/cloudguruab/os-migrate">https://github.com/cloudguruab/os-migrate</a>.
[cloudguruab]</p></li>
<li><p>Merge branch ‘main’ of <a class="reference external" href="https://github.com/cloudguruab/os-migrate">https://github.com/cloudguruab/os-migrate</a>.
[cloudguruab]</p></li>
<li><p>Merge branch ‘main’ of <a class="reference external" href="https://github.com/cloudguruab/os-migrate">https://github.com/cloudguruab/os-migrate</a>.
[cloudguruab]</p></li>
</ul>
</section>
</section>
<section id="id4">
<h2>0.15.1 (2023-06-06)<a class="headerlink" href="#id4" title="Permalink to this heading"></a></h2>
<section id="id5">
<h3>New<a class="headerlink" href="#id5" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Stable 0.15.0. [cloudguruab]</p></li>
<li><p>Mac preservation enhancement for server_port instance (#603) [Adrian
Brown]</p>
<ul>
<li><p>new: mac preservation enhancement for server_port instance</p></li>
<li><p>dev: fix to cachecontrols error</p></li>
</ul>
</li>
</ul>
</section>
<section id="id6">
<h3>Fix<a class="headerlink" href="#id6" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Update to CentOS-8 qcow image version for e2e devel env setup.
[cloudguruab]</p></li>
</ul>
</section>
</section>
<section id="id7">
<h2>0.15.0 (2023-04-20)<a class="headerlink" href="#id7" title="Permalink to this heading"></a></h2>
<section id="id8">
<h3>New<a class="headerlink" href="#id8" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Port creation via neutron api. [cloudguruab]</p></li>
<li><p>Neutron port creation for workloads. [cloudguruab]</p></li>
<li><p>Patch to user project role assignment bug. [cloudguruab]</p></li>
<li><p>Process for cleaning stuck lockfiles in use_lock (#590) [Adrian Brown]</p></li>
<li><p>Validate changelog using lint-commit-messages target. [Jiří Stránský]</p></li>
</ul>
</section>
<section id="id9">
<h3>Fix<a class="headerlink" href="#id9" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Support cacert in clouds.yaml template. [Pierre Riteau]</p></li>
</ul>
</section>
</section>
<section id="id10">
<h2>0.14.0 (2022-09-22)<a class="headerlink" href="#id10" title="Permalink to this heading"></a></h2>
<section id="id11">
<h3>New<a class="headerlink" href="#id11" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Conversion host updates. [cloudguruab]</p></li>
<li><p>Update to auth on missed ansible parts. [cloudguruab]</p></li>
<li><p>Use clouds.yml for auth config on project resources (#563) [Adrian
Brown]</p></li>
<li><p>Use cloud config for auth on workload resources (#569) [Adrian Brown]</p></li>
<li><p>Use clouds config for auth on users resources (#568) [Adrian Brown]</p></li>
<li><p>Use cloud config for auth on subnet resource (#566) [Adrian Brown]</p></li>
<li><p>Use cloud config for auth on security group resources (#565) [Adrian
Brown]</p></li>
<li><p>Use clouds.yml config for auth on routers resource (#564) [Adrian
Brown]</p></li>
<li><p>Use clouds.yml config for auth on flavor resources (#562) [Adrian
Brown]</p></li>
<li><p>Use clouds.yml config for auth on image resources (#561) [Adrian
Brown]</p></li>
<li><p>Use clouds.yaml in keypair migration. [cloudguruab]</p></li>
<li><p>Use clouds.yaml auth approach in network import/export. [cloudguruab]</p></li>
<li><p>Use clouds.yaml auth approach in network import/export (#559) [Adrian
Brown]</p></li>
<li><p>Write auth config to clouds.yaml (#552) [Adrian Brown]</p></li>
<li><p>Sort exported server ports as they appear in Nova API. [Jiri Stransky]</p>
<p>We export server port info from Neutron API, because it gives more
information about the port. However, querying ports from Neutron seems
to give a somewhat random order of the ports.</p>
<p>Now we still export the same Neutron info about ports, but we sort
them based on the order in which the VM IP addresses appear in
OpenStack SDK’s ‘compute.get_server’ return value.</p>
<p>This approach cannot guarantee that the original order of NICs is
preserved during migration (Nova does not guarantee NIC ordering [1]),
but it makes it more likely that the NIC order will be preserved
during migration.</p>
<p>[1] <a class="reference external" href="https://bugzilla.redhat.com/show_bug.cgi?id=1798126">https://bugzilla.redhat.com/show_bug.cgi?id=1798126</a></p>
</li>
<li><p>Skip serialization if dns_domain is false. [cloudguruab]</p></li>
<li><p>Import user project role assignment. [cloudguruab]</p></li>
<li><p>User project role assignments export. [Adrian Brown]</p></li>
<li><p>Introduced validate_resource_files role (#532) [Adrian Brown]</p></li>
</ul>
</section>
<section id="id12">
<h3>Changes<a class="headerlink" href="#id12" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Documentation for keypair migration pitfalls and solutions.
[cloudguruab]</p></li>
</ul>
</section>
<section id="id13">
<h3>Fix<a class="headerlink" href="#id13" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Update to resource type. [cloudguruab]</p></li>
<li><p>Export of subnets with multiple allocation pools. [Jiri Stransky]</p>
<p>Subnets with multiple allocation pools previously crashed on export
due to an issue with parameter sorting. This is now fixed.</p>
</li>
</ul>
</section>
</section>
<section id="id14">
<h2>0.13.0 (2022-03-30)<a class="headerlink" href="#id14" title="Permalink to this heading"></a></h2>
<section id="id15">
<h3>New<a class="headerlink" href="#id15" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Customize availbility zone for conversion hosts. [adrian]</p>
<p>It is now possible to customize conversion host availability zones via
these new variables:</p>
<p>os_migrate_src_conversion_availability_zone
os_migrate_dst_conversion_availability_zone</p>
</li>
<li><p>Ensure correct mode on conversion host ssh key. [Jiri Stransky]</p>
<p>Sometimes when using pre-existing key and mounting it into a
container, the mode seems to be set wrong (reason not discovered). We
now make sure that the conversion host key has mode ‘0600’ before
using it, otherwise ssh would refuse to work with it anyway.</p>
</li>
<li><p>Allow using conversion hosts without floating IPs. [Jiri Stransky]</p>
<p>Conversion hosts now can be created without floating IPs. Whether FIPs
should be managed or not is controlled via these new variables:</p>
<blockquote>
<div><p>os_migrate_src_conversion_manage_fip
os_migrate_dst_conversion_manage_fip</p>
</div></blockquote>
<p>Having conversion hosts without FIPs is useful when attaching the
hosts directly onto public networks. This use case is described in
more detail in the docs (Variables Guide).</p>
</li>
<li><p>Customizing src/dst names of conversion host dependency resources.
[Jiri Stransky]</p>
<p>Conversion host dependency resource names can now be customized
differently per source/destination cloud. The relevant new variables
are:</p>
<blockquote>
<div><p>os_migrate_src_conversion_net_name
os_migrate_dst_conversion_net_name
os_migrate_src_conversion_subnet_name
os_migrate_dst_conversion_subnet_name
os_migrate_src_conversion_router_name
os_migrate_dst_conversion_router_name
os_migrate_src_conversion_secgroup_name
os_migrate_dst_conversion_secgroup_name
os_migrate_src_conversion_keypair_name
os_migrate_dst_conversion_keypair_name</p>
</div></blockquote>
</li>
<li><p>Allow using existing network with conversion hosts. [Jiri Stransky]</p>
<p>It is now possible to disable creation and deletion of private
network+subnet+router for the conversion hosts via new variables:</p>
<p>os_migrate_src_conversion_manage_network
os_migrate_dst_conversion_manage_network</p>
<p>The hosts will attach to pre-existing network defined by
<cite>os_migrate_conversion_net_name</cite>.</p>
</li>
<li><p>Docs page with troubleshooting tips. [Jiri Stransky]</p></li>
</ul>
</section>
<section id="id16">
<h3>Changes<a class="headerlink" href="#id16" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Improve error message on data version mismatch. [Jiri Stransky]</p>
<p>After upgrading without clearing old exported data, OS Migrate refuses
to parse the old data files. The resulting error message was not clear
enough about the likely root cause and solution. Path to the
problematic file and extra hints are now added to the exception
message, as this is a relatively common pitfall.</p>
</li>
</ul>
</section>
<section id="id17">
<h3>Fix<a class="headerlink" href="#id17" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Replace akward openstacksdk version check. [Dmitriy Rabotyagov]</p>
<p>Using shell for getting pip version leads to several highly possible
side effects. As example, you verify opensatcksdk persistance against
ENV however following tasks will use ansible_python_interpreter that
likely differ if virtualenv is used for ansible.</p>
<p>Another side effect is that openstacksdk could be installed in venv
which is not respected by shell when you provide interpreter for host
explicitly.</p>
<p>With this patch we replace shell with pip_package_info module that
collects all installed packages against ansible_python_interpeter.</p>
</li>
<li><p>Enforce the executable argument when executing shell. [Carlos Camacho]</p>
<p>Currently the migrator host is not limited to be only
CentOS, Fedora, or RHEL. In the case a user runs OS
migrate from a Linux distribution which is not using
Bash as the default terminal, options like pipefail
might not be availabe (i.e. Ubuntu and ZSH) for
those cases we need to make explicit that the shell
we will use is Bash.</p>
<p>This commit enforce to use and set explicitly
the executable when running ansible.builtin.shell.</p>
</li>
</ul>
</section>
<section id="id18">
<h3>Other<a class="headerlink" href="#id18" title="Permalink to this heading"></a></h3>
<ul>
<li><p>F/dev env setup improvements (#520) [Adrian Brown, Jiri Stransky]</p>
<ul class="simple">
<li><p>New: Customize availbility zone for conversion hosts</p></li>
</ul>
<p>It is now possible to customize conversion host availability zones via
these new variables:</p>
<p>os_migrate_src_conversion_availability_zone
os_migrate_dst_conversion_availability_zone</p>
<ul class="simple">
<li><p>Dev: Don’t run lints with Ansible 2.9</p></li>
</ul>
<p>This is to work around an issue with ansible-lint:</p>
<p><a class="reference external" href="https://github.com/ansible-community/ansible-lint-action/issues/41">https://github.com/ansible-community/ansible-lint-action/issues/41</a></p>
<ul class="simple">
<li><p>Dev: Refactor argument ordering to satisfy pylint</p></li>
</ul>
<p>We shouldn’t change the ordering of arguments of create_or_update when
subclassing Resource, we should just add a new parameter at the end.</p>
<ul class="simple">
<li><p>dev: allow vagrant on headless servers</p></li>
<li><p>dev: update vagrant to fedora35</p></li>
</ul>
<p>horizon was broken on fedora35, dont need so it is disabled.</p>
<ul class="simple">
<li><p>dev: documentation update for variables in e2e setup</p></li>
</ul>
</li>
<li><p>Docs: Fix link on install-from-galaxy which address to install-from-
source. [Juan Badia Payno]</p></li>
</ul>
</section>
</section>
<section id="id19">
<h2>0.12.0 (2021-11-19)<a class="headerlink" href="#id19" title="Permalink to this heading"></a></h2>
<section id="id20">
<h3>New<a class="headerlink" href="#id20" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Allow creating conversion hosts as boot-from-volume servers. [Jiri
Stransky]</p>
<p>The operator can now control if conversion hosts are backed by a local
Nova disk (still the default), or if they are created as
boot-from-volume. The parameters which control the behavior are:</p>
<blockquote>
<div><p>os_migrate_src_conversion_host_boot_from_volume
os_migrate_dst_conversion_host_boot_from_volume</p>
</div></blockquote>
</li>
<li><p>Include an openstacksdk check in the preludes roles. [Carlos Camacho]</p>
<p>This commit adds a package version check in the prelude_src
and prelude_dst roles so we verify the user has a known working
openstacksdk version before running the migrations.</p>
</li>
</ul>
</section>
<section id="id21">
<h3>Fix<a class="headerlink" href="#id21" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Compatibility with PyYAML 6.x, safe YAML. [Jiri Stransky]</p>
<p>When PyYAML 6.x is used as a dependency, the load_resources_file
function crashes with:</p>
<p>TypeError: load() missing 1 required positional argument: ‘Loader’</p>
<p>The best fix here should be switching to the YAML’s safe_load and
safe_dump functions. These should be preferred because we do not need
to serialize arbitrary Python objects, we serialize basic data types,
dicts and lists.</p>
</li>
</ul>
</section>
</section>
<section id="id22">
<h2>0.11.1 (2021-10-19)<a class="headerlink" href="#id22" title="Permalink to this heading"></a></h2>
<section id="id23">
<h3>Fix<a class="headerlink" href="#id23" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Compatibility with PyYAML 6.x, safe YAML. [Jiri Stransky]</p>
<p>When PyYAML 6.x is used as a dependency, the load_resources_file
function crashes with:</p>
<p>TypeError: load() missing 1 required positional argument: ‘Loader’</p>
<p>The best fix here should be switching to the YAML’s safe_load and
safe_dump functions. These should be preferred because we do not need
to serialize arbitrary Python objects, we serialize basic data types,
dicts and lists.</p>
<p>(cherry picked from commit 40982ecc8ad7b32f1b906d67dd998f884bae9de0)</p>
</li>
</ul>
</section>
</section>
<section id="id24">
<h2>0.11.0 (2021-10-08)<a class="headerlink" href="#id24" title="Permalink to this heading"></a></h2>
<section id="id25">
<h3>New<a class="headerlink" href="#id25" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Allow using pre-existing floating IPs for migrated servers. [Jiri
Stransky]</p>
<p>Two new floating_ip_mode migration parameter values are introduced:
‘new’ and ‘existing’. The modes now behave this way:</p>
<ul class="simple">
<li><p>‘skip’ - Do not create any floating IPs.</p></li>
<li><p>‘new’ - Create a new floating IP (auto-assigned address).</p></li>
<li><p>‘existing’ - Assume the floating IP address specified in the
workload serialization is already assigned to the destination
project, but not attached. Attach this floating IP. If this is not
possible for some reason, fail.</p></li>
<li><p>‘auto’ - Attempt the ‘existing’ method of floating IP assignment,
but instead of failing, fall back to the ‘new’ method.</p></li>
</ul>
</li>
<li><p>Allow deleting or detaching the conversion hosts FIPs. [Carlos
Camacho]</p>
<p>This commit enables users to detach or demove floating IPs
when deleting the conversion hosts.</p>
</li>
</ul>
</section>
<section id="id26">
<h3>Changes<a class="headerlink" href="#id26" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Install conversion host content in parallel again. [Jiri Stransky]</p>
<p>Content installation went from parallelized to non-parallelized when
we introduced pre/post-content hooks, so that we could feed different
variable values per host.</p>
<p>This commit keeps the per-host variables by setting them via the
<cite>set_fact</cite> module prior to executing the <cite>conversion_host_content</cite>
role. The role itself then does not need per-host variables and runs
in parallel on both conversion hosts. This can speed up the
conversion host deployment playbook noticeably.</p>
</li>
</ul>
</section>
<section id="id27">
<h3>Fix<a class="headerlink" href="#id27" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Remove unnecessary 10s delay in conversion host discovery. [Jiri
Stransky]</p>
<p>Probably <cite>sleep</cite> (pause between attempts) was meant instead of <cite>delay</cite>
(pause before the first attempt). Use a 5 second <cite>sleep</cite>.</p>
</li>
<li><p>Only perform keypair lookup in dst if server has keypair. [Philip
Roche]</p>
<p>When validating workload migration we should only validate if the keypair
specified in the workload/vm is present in the destination environment if the
workload/vm has a keypair associated with it.</p>
</li>
<li><p>Validate keypairs exist in destination cloud before migrating
workload. [Philip Roche]</p>
<p>dst_prerequisites_errorsclass method is used to validate prerequisites
before migrating workloads but the parent class dst_prerequisites_errors
does not validate keypairs exist in destination cloud. To do this we do
a lookup to see if keypair name exists and append to errors list if not</p>
</li>
</ul>
</section>
<section id="id28">
<h3>Other<a class="headerlink" href="#id28" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Oth: Improve workload data flow diagram. [Jiri Stransky]</p>
<p>The data flow diagram in “OS Migrate Walkthrough” and “How It Works:
Workload Migration” now has more clarity on how (meta)data travels
during workload migration.</p>
</li>
<li><p>Docs: fix walkthrough links. [Carlos Camacho]</p>
<p>This commit fixes some wrong links
in the docs</p>
</li>
</ul>
</section>
</section>
<section id="id29">
<h2>0.10.1 (2021-09-02)<a class="headerlink" href="#id29" title="Permalink to this heading"></a></h2>
<section id="id30">
<h3>Fix<a class="headerlink" href="#id30" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Make explicit the conversion hosts inventory update. [Carlos Camacho]</p></li>
</ul>
</section>
</section>
<section id="id31">
<h2>0.10.0 (2021-09-01)<a class="headerlink" href="#id31" title="Permalink to this heading"></a></h2>
<section id="id32">
<h3>New<a class="headerlink" href="#id32" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Add a floating IP after creating the server instance. [Carlos Camacho]</p>
<p>This commit disables the auto floating IP allocation when the
conversion host is created and explicitly assigns the floating
IP once the instance is running. Also allows to specify custom
floating IPs.</p>
</li>
<li><p>Conditionally stop VMs before migration. [Philip Roche]</p>
<p>Set os_migrate_workload_stop_before_migration to true to stop VMs before migration occurs.</p>
<p>Default is false but set to true for e2e tests</p>
</li>
<li><p>Allow disabling the RHSM tasks. [Carlos Camacho]</p>
<p>This commit allows to disable the execution
of the RHSM tasks.</p>
</li>
<li><p>Allow configuring the conversion hosts names. [Carlos Camacho]</p>
<p>This commit allows to configure the conversion hosts
names.</p>
</li>
<li><p>Allow running scripts in the conversion hosts. [Carlos Camacho]</p>
<p>This commit allows to run custom bash scripts in
the conversion hosts before and after the content
playbook.</p>
</li>
<li><p>Include additional RHSM repositories. [Carlos Camacho]</p>
<p>This commit allows to enable a list of new RHSM
repositories in the conversion hosts.</p>
</li>
<li><p>Ability to specify boot volume params when source VM has no boot
volume. [Jiri Stransky]</p>
<p>When the source VM does not have a boot volume, its boot disk should
be copied (<cite>boot_disk_copy</cite> is <cite>true</cite>), then a boot volume will be
created only in destination. Since there was no boot volume serialized
in the workload YAML, we need an alternative way to allow editing
volume creation parameters. New <cite>boot_volume_params</cite> migration
parameter is introduced for this purpose.</p>
</li>
<li><p>Customizable attached volume properties in workload migration. [Jiri
Stransky]</p>
<p>Attached volumes are now exported in the ‘params’ section of workload
serialization, as nested resources. This allows editing these desired
properties of attached volumes that should be created in the
destination cloud: name, description, availability zone, volume type.</p>
</li>
<li><p>Allow ssh access to conversion host using a default password. [Carlos
Camacho]</p>
<p>This commit allows to configure a default password in both
centos and cloud-user users, this can help connecting directly
to the hosts with a default password disabled by default.</p>
<p>Added os_migrate_conversion_host_ssh_user_enable_password_access
disabled by default.</p>
</li>
</ul>
</section>
<section id="id33">
<h3>Fix<a class="headerlink" href="#id33" title="Permalink to this heading"></a></h3>
<ul>
<li><p>For resources that have name, reject migration of resources with empty
name. [Philip Roche]</p>
<p>For resources which have a name property validate that it is non empty.</p>
<p>This fixes an issue where resources with empty names are not included in the check
for uniqueness/idempotence. By checking for empty names we avoid this issue.</p>
</li>
<li><p>In rhsm auto_attach once defaulted will always collide with
activationkey. [Carlos Camacho]</p>
<p>Once a variable is defaulted to an existing value it can not
be omited, auto_attach is defaulted to true so if activationkey
it can not be put back to omit.</p>
<p>omit is a special variable for omitting an individual argument
to a module with only that value, and once defined it can not
be omited again.</p>
</li>
<li><p>Glance API attribute ‘stores’ is read-only now (#443) [Philip Roche]</p>
<p>Fix: Glance API attribute ‘stores’ is read-only now</p>
<p>Due to bug <a class="reference external" href="https://bugs.launchpad.net/glance/+bug/1889676">https://bugs.launchpad.net/glance/+bug/1889676</a> glance now
sets stores as a read only property. As such we should remove it from
any create image calls.</p>
<p>See <a class="reference external" href="https://github.com/openstack/glance/commit/e1f0e94b90b162b1cdca5bdd7af3c09a90ca80ac#diff-3a53e94e6a14f08e4e3305f4e4388819cef4f35a9277afeab2f07bc2664489d6">https://github.com/openstack/glance/commit/e1f0e94b90b162b1cdca5bdd7af3c09a90ca80ac#diff-3a53e94e6a14f08e4e3305f4e4388819cef4f35a9277afeab2f07bc2664489d6</a>
for the Glance API change and also see conversation on
terraform-provider-openstack repo &#64;
<a class="reference external" href="https://github.com/terraform-provider-openstack/terraform-provider-openstack/issues/1091#issuecomment-806003499">https://github.com/terraform-provider-openstack/terraform-provider-openstack/issues/1091#issuecomment-806003499</a>
for some related context.</p>
<p>This bug was found when testing e2e tests using an infrared deployed Openstack 16.1.</p>
</li>
</ul>
</section>
<section id="id34">
<h3>Other<a class="headerlink" href="#id34" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Oth: User documentation on the inner workings of workload migration.
[Jiri Stransky]</p></li>
<li><p>Docs: Add password-based authentication variable docs. [Carlos
Camacho]</p>
<p>This commit adds the information for the ssh access using
password in the conversion hosts.</p>
</li>
<li><p>Oth: General usage notes and TLS variables docs. [Jiri Stransky]</p>
<p>The documentation is extended with a separate page for general usage
notes, and info about API TLS-related variables is added to the
variables guide.</p>
</li>
<li><p>Oth: Add upgrade documentation. [Jiri Stransky]</p></li>
<li><p>Update comment in image.py. [Yaniv Kaul]</p>
<p>Fixes issue #437</p>
</li>
</ul>
</section>
</section>
<section id="id35">
<h2>0.9.0 (2021-07-08)<a class="headerlink" href="#id35" title="Permalink to this heading"></a></h2>
<section id="id36">
<h3>New<a class="headerlink" href="#id36" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Import of users’ Nova keypairs as admin. [Jiri Stransky]</p>
<p>Import of Nova keypairs can now be done for other users as well,
provided that the authenticated user running the playbook is
authorized to read and create keys for other users (an admin
user is typically authorized to do that). The playbook to perform this
import is called <cite>import_users_keypairs.yml</cite>.</p>
<p>Both <cite>os_migrate_users_filter</cite> and <cite>os_migrate_keypairs_filter</cite>
variables are respected when iterating over users and their keypairs.</p>
</li>
<li><p>Export of users’ Nova keypairs as admin. [Jiri Stransky]</p>
<p>Export of Nova keypairs can now be done for other users as well,
provided that the authenticated user running the playbook is
authorized to list users and their keys and read those keys (an admin
user is typically authorized to do that). The playbook to perform this
export is called <cite>export_users_keypairs.yml</cite>.</p>
<p>Both <cite>os_migrate_users_filter</cite> and <cite>os_migrate_keypairs_filter</cite>
variables are respected when iterating over users and their keypairs.</p>
</li>
<li><p>Delete volumes when deleting the conversion hosts. [Carlos Camacho]</p>
<p>This commit adds the hability to remove automatically
the volume created with the conversion host once
the VM is destroyed.</p>
</li>
</ul>
</section>
<section id="id37">
<h3>Changes<a class="headerlink" href="#id37" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Stop capping recommended OpenStack SDK on 0.52. [Jiri Stransky]</p>
<p>The security groups bug [1] introduced in OpenStack SDK 0.53 has been
fixed, we start recommending and testing with the latest SDK again.</p>
<p>[1] <a class="reference external" href="https://storyboard.openstack.org/#!/story/2008577">https://storyboard.openstack.org/#!/story/2008577</a></p>
</li>
<li><p>Increase the linelenght for the lint tests. [Carlos Camacho]</p>
<p>Lint tests are failing with the line lenght &lt;=100.
This commits increases the limit to 150.</p>
</li>
<li><p>Add retry logic to RHSM. [Carlos Camacho]</p>
<p>This commit adds the retry logic when
using RHSM in the conversion hosts.</p>
</li>
<li><p>Add the conversion hosts to specific groups. [Carlos Camacho]</p>
<p>This commit allows having two additional
groups for the conversion hosts.
conversion_hosts_src and conversion_hosts_dst</p>
</li>
</ul>
</section>
<section id="id38">
<h3>Fix<a class="headerlink" href="#id38" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Consider same-named keys for different users as valid for import.
[Jiri Stransky]</p>
<p>The OS Migrate import validation used resource type + name to define
identity. This works as expected when working in project scope. But as
we added keypair migration by admin on behalf of other users, and
keypairs are scoped to users, having multiple keypairs of the same
name is valid as long as they are owned by different users. This
commit refactors validation mechanisms to support custom notions of
import identity per resource type, and keypairs use a tuple of
resource type + resource name + user name + user domain.</p>
</li>
<li><p>Allow exporting same-named keypairs for different users. [Jiri
Stransky]</p>
<p>Keypair IDs are typically the same as their names, they aren’t
randomized UUIDs. We cannot rely on them for distinguishing
uniqueneess on export and performing idempotency checks when exporting
to a file which already contains some resources. The sameness check
now uses ID + user_ref tuple, making it possible to export keys with
the same ID values for mutliple users.</p>
</li>
<li><p>Conversion host network MTUs default to cloud defaults. [Jiri
Stransky]</p>
<p>Previously we had conversion host network MTUs decided by variables
<cite>os_migrate_src_release</cite> and <cite>os_migrate_dst_release</cite> and decided MTUs
for conversion host network based on those. These were test-specific
decisions leaking into production settings. We now default the MTU
parameters to Ansible’s <cite>omit</cite> special value, which means the module
responsible for creating the network will not specify any value in the
network creation API request, and the MTU will be autoselected by the
cloud.</p>
<p>If the defaults result in undesirable values, the MTUs can still be
explicitly overriden via <cite>os_migrate_src_conversion_net_mtu</cite> and
<cite>os_migrate_dst_conversion_net_mtu</cite> variables.</p>
<p>This fix also removes dependency of production code on
<cite>os_migrate_src_release</cite> and <cite>os_migrate_dst_release</cite> variables, as
currently OS Migrate does not alter behavior based on src/dst release.</p>
</li>
<li><p>Remove unnecessary delay in conversion host reachability check. [Jiri
Stransky]</p>
<p>In conversion host reachability check, with the <cite>wait_for</cite> Ansible
module we used <cite>delay</cite> of 10 seconds, which caused a delay before the
first check, causing unnecessary slowdown (20 seconds in total) of the
import_workloads playbook. What we probably meant to use was <cite>sleep</cite>,
which sets the interval between checks. This is now fixed and the
<cite>sleep</cite> property is set to 5 seconds.</p>
</li>
<li><p>Only use ‘type’ on keypairs when it is supported. [Jiri Stransky]</p>
<p>SDK should support ‘type’ on keypairs since 0.32 [1], however even
with 0.36 this error still appears when testing against latest
Devstack:</p>
<p>openstack.exceptions.BadRequestException: BadRequestException: 400:
Client Error for url: <a class="reference external" href="http://192.168.122.93/compute/v2.1/os-keypairs">http://192.168.122.93/compute/v2.1/os-keypairs</a>,
Invalid input for field/attribute keypair. Value: {‘type’: ‘ssh’,
&lt;REDACTED&gt;, ‘name’: ‘osm_keypair’}. Additional properties are not
allowed (‘type’ was unexpected).</p>
<p>This error disappears when testing with latest SDK. It’s not easy to
track down what exact combinations of SDK/API are needed to allow for
‘type’ in keypair creation request. So we’ll first try with ‘type’,
and if that request fails with error 400 (Bad Request), then we retry
without ‘type’. If that request still fails, the keypair import module
fails too.</p>
<p>[1] <a class="reference external" href="https://github.com/openstack/openstacksdk/commit/15baef656ac56421a71e691982a70b218110f18d">https://github.com/openstack/openstacksdk/commit/15baef656ac56421a71e691982a70b218110f18d</a></p>
</li>
<li><p>Flavor extra_specs import with OpenStack SDK older than 0.51. [Jiri
Stransky]</p>
<p>The previous implementation of extra_specs import on flavors only
worked with SDK &gt;=0.51. A fallback implementation is now added for
running with older SDKs. This fallback implementation can be dropped
in the future after we drop support for SDK &lt;0.51.</p>
</li>
<li><p>Handle when flavor extra_specs are reported as None from API. [Jiri
Stransky]</p>
<p>Most recent APIs+SDKs always give empty hash for extra_specs. However,
some older versions may also return extra_specs as None. This could
break OS Migrate. The issue is now fixed by making sure we set
internal variables to {} whenever some extra_specs parameter (either
loaded from YAML or queried from SDK) is None.</p>
</li>
<li><p>Do not check for the subscribed_pool_ids. [Carlos Camacho]</p>
<p>Our internal RHSM server does not reply with
subscribed_pool_ids, as it is always an empty
list. This commit checks that the
machines are correctly subscribed.</p>
</li>
<li><p>Increase timeouts when deployment takes more than default. [Carlos
Camacho]</p>
<p>This commit allows to increase the hardwired default timeout of
600 seconds when deploying the conversion hosts.</p>
<p>In this case, when the overlay network provider takes longer to
assign a floating IP, there might be needed to increase this
default.</p>
</li>
<li><p>Export RouterInterface of HA and DVR routers. [Jiri Stransky]</p>
<p>Previously when exporting router interfaces, only ports with
device_owner value of ‘network:router_interface’ were picked up. This
would not export interfaces correctly for HA/DVR routers. We now also
export ports with device_owner values of
‘network:ha_router_replicated_interface’ and
‘network:router_interface_distributed’ for HA/DVR routers.</p>
</li>
<li><p>Make sure the src/dst release is an integer. [Carlos Camacho]</p>
<p>This commit cast the os_migrate_src_release and
os_migrate_dst_release variables to integers.</p>
</li>
</ul>
</section>
</section>
<section id="id39">
<h2>0.8.4 (2021-06-16)<a class="headerlink" href="#id39" title="Permalink to this heading"></a></h2>
<section id="id40">
<h3>Fix<a class="headerlink" href="#id40" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Conversion host network MTUs default to cloud defaults. [Jiri
Stransky]</p>
<p>Previously we had conversion host network MTUs decided by variables
<cite>os_migrate_src_release</cite> and <cite>os_migrate_dst_release</cite> and decided MTUs
for conversion host network based on those. These were test-specific
decisions leaking into production settings. We now default the MTU
parameters to Ansible’s <cite>omit</cite> special value, which means the module
responsible for creating the network will not specify any value in the
network creation API request, and the MTU will be autoselected by the
cloud.</p>
<p>If the defaults result in undesirable values, the MTUs can still be
explicitly overriden via <cite>os_migrate_src_conversion_net_mtu</cite> and
<cite>os_migrate_dst_conversion_net_mtu</cite> variables.</p>
<p>This fix also removes dependency of production code on
<cite>os_migrate_src_release</cite> and <cite>os_migrate_dst_release</cite> variables, as
currently OS Migrate does not alter behavior based on src/dst release.</p>
<p>(cherry picked from commit c58f7d94e2ccfe52eaa8105dfa460cf0ccf7b15c)</p>
</li>
</ul>
</section>
</section>
<section id="id41">
<h2>0.8.3 (2021-06-10)<a class="headerlink" href="#id41" title="Permalink to this heading"></a></h2>
<section id="id42">
<h3>Fix<a class="headerlink" href="#id42" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Remove unnecessary delay in conversion host reachability check. [Jiri
Stransky]</p>
<p>In conversion host reachability check, with the <cite>wait_for</cite> Ansible
module we used <cite>delay</cite> of 10 seconds, which caused a delay before the
first check, causing unnecessary slowdown (20 seconds in total) of the
import_workloads playbook. What we probably meant to use was <cite>sleep</cite>,
which sets the interval between checks. This is now fixed and the
<cite>sleep</cite> property is set to 5 seconds.</p>
<p>(cherry picked from commit de1647b8ac43461d521e9e7d002eebc3a2227135)</p>
</li>
<li><p>Only use ‘type’ on keypairs when it is supported. [Jiri Stransky]</p>
<p>SDK should support ‘type’ on keypairs since 0.32 [1], however even
with 0.36 this error still appears when testing against latest
Devstack:</p>
<p>openstack.exceptions.BadRequestException: BadRequestException: 400:
Client Error for url: <a class="reference external" href="http://192.168.122.93/compute/v2.1/os-keypairs">http://192.168.122.93/compute/v2.1/os-keypairs</a>,
Invalid input for field/attribute keypair. Value: {‘type’: ‘ssh’,
&lt;REDACTED&gt;, ‘name’: ‘osm_keypair’}. Additional properties are not
allowed (‘type’ was unexpected).</p>
<p>This error disappears when testing with latest SDK. It’s not easy to
track down what exact combinations of SDK/API are needed to allow for
‘type’ in keypair creation request. So we’ll first try with ‘type’,
and if that request fails with error 400 (Bad Request), then we retry
without ‘type’. If that request still fails, the keypair import module
fails too.</p>
<p>[1] <a class="reference external" href="https://github.com/openstack/openstacksdk/commit/15baef656ac56421a71e691982a70b218110f18d">https://github.com/openstack/openstacksdk/commit/15baef656ac56421a71e691982a70b218110f18d</a></p>
<p>(cherry picked from commit 3edc278aaca222d48b587caa9e8c9f1d3162d98d)</p>
</li>
<li><p>Flavor extra_specs import with OpenStack SDK older than 0.51. [Jiri
Stransky]</p>
<p>The previous implementation of extra_specs import on flavors only
worked with SDK &gt;=0.51. A fallback implementation is now added for
running with older SDKs. This fallback implementation can be dropped
in the future after we drop support for SDK &lt;0.51.</p>
<p>(cherry picked from commit 224b779da2e552094964bde5127a715c58e48e22)</p>
</li>
<li><p>Handle when flavor extra_specs are reported as None from API. [Jiri
Stransky]</p>
<p>Most recent APIs+SDKs always give empty hash for extra_specs. However,
some older versions may also return extra_specs as None. This could
break OS Migrate. The issue is now fixed by making sure we set
internal variables to {} whenever some extra_specs parameter (either
loaded from YAML or queried from SDK) is None.</p>
<p>(cherry picked from commit 29c7d17856984487f628676478fbdecdd8526ecd)</p>
</li>
</ul>
</section>
</section>
<section id="id43">
<h2>0.8.2 (2021-05-25)<a class="headerlink" href="#id43" title="Permalink to this heading"></a></h2>
<section id="id44">
<h3>Fix<a class="headerlink" href="#id44" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Make sure the src/dst release is an integer. [Carlos Camacho]</p>
<p>This commit cast the os_migrate_src_release and
os_migrate_dst_release variables to integers.</p>
<p>Fixes: #408
(cherry picked from commit 6902b3d9be04823d5ef654a909a5b1baafec7d8e)</p>
</li>
<li><p>Export RouterInterface of HA and DVR routers. [Jiri Stransky]</p>
<p>Previously when exporting router interfaces, only ports with
device_owner value of ‘network:router_interface’ were picked up. This
would not export interfaces correctly for HA/DVR routers. We now also
export ports with device_owner values of
‘network:ha_router_replicated_interface’ and
‘network:router_interface_distributed’ for HA/DVR routers.</p>
<p>(cherry picked from commit d486fe9132760bc054e66bddbdc4f6702550da81)</p>
</li>
</ul>
</section>
</section>
<section id="id45">
<h2>0.8.1 (2021-05-12)<a class="headerlink" href="#id45" title="Permalink to this heading"></a></h2>
<section id="id46">
<h3>Fix<a class="headerlink" href="#id46" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Project parent references allow domains too. [Jiri Stransky]</p>
<p>Keystone has 2 types of domains - domain objects, and project objects
with is_domain=True. OS Migrate correctly worked only with the latter
until now. Domain objects are now working too, and it is tested in
functional tests.</p>
</li>
<li><p>Preserve domain on user export/import. [Jiri Stransky]</p>
<p>We now preserve domain when migrating users. This means the domain of
a given name needs to exist in the destination cloud.</p>
</li>
<li><p>Preserve domain and parent for projects. [Jiri Stransky]</p>
<p>The references to project parents and domains are now exported and
used during import. This makes it possible to export/import projects
from non-default domains, but also requires making sure that the
domain exists in destination.</p>
</li>
<li><p>Preserve keypair type on migration. [Jiri Stransky]</p>
<p>Type can be ‘ssh’ or ‘x509’, let’s preserve the value.</p>
<p>The ‘private_key’ param is removed since it is always null for
exports/imports (it is only used when Nova auto-generates a new key).</p>
<p>The keypair migration test is moved from as-admin test suite into
as-tenant test suite.</p>
</li>
</ul>
</section>
</section>
<section id="id47">
<h2>0.8.0 (2021-04-23)<a class="headerlink" href="#id47" title="Permalink to this heading"></a></h2>
<section id="id48">
<h3>New<a class="headerlink" href="#id48" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Configurable timeout for non-immediate actions. [Jiri Stransky]</p>
<p>Until now, non-immediate actions and blocking calls to OpenStack SDK
within workload migration have used a hard-coded timeout of 30
minutes. New variable <cite>os_migrate_timeout</cite> has been introduced for
setting the timeout (in seconds), the value is 1800 (= 30 minutes).</p>
</li>
<li><p>Add volume attachements info to workload exports. [Jiri Stransky]</p>
<p>In the workloads YAML file we now write information about volume
attachments into the _info section. The actual volumes to migrate are
looked up again during the import phase, so this new serialized
information does not have any effect on the migration, but it can be
helpful when debugging.</p>
</li>
<li><p>Ensure Nova server creation is successful and emit detailed info.
[Jiri Stransky]</p>
<p>The import_workload_create_instance module now outputs a full workload
serialization of the server created in the destination cloud. When
running Ansible in verbose mode, it can be used as debugging
information, and allows for direct comparison of the destination
workload to the contents of workloads.yml file.</p>
<p>This requires that the import_workload_create_instance module waits
for the Nova server to enter ACTIVE state, to have full information
available. Typically this only adds several seconds to the workload
migration time, which is negligible in the full picture. By waiting,
we can also make sure the server indeed does go ACTIVE and not into
ERROR state, which may have previously gone unnoticed with the “fire
and forget” server creation approach.</p>
</li>
<li><p>Validate destination prerequisites before migrating a workload. [Jiri
Stransky]</p>
<p>Before workload storage migration is started, it is now validated that
the server’s references to resources like flavor, image, security
group, network, or subnet can be properly resolved in the destination
cloud. This aims to avoid situations where the block storage is first
successfully copied and then the server creation fails due to a
trivial problem.</p>
</li>
<li><p>Validate resource data structure. [Jiri Stransky]</p>
<p>When resources are being loaded, we now validate that the resource has
all the expected <cite>params</cite> and <cite>_migration_params</cite> and <cite>_info.id</cite>.
Errors are reported for resources that cannot be parsed. The resources
in error messages are identified by type+name+id tuple, if those
attributes of the resource aren’t missing.</p>
</li>
<li><p>Filters in import playbooks. [Jiri Stransky]</p>
<p>The <cite>os_migrate_&lt;resources&gt;_filter</cite> variables that are already used to
filter resources during export, are now respected during import
too. That means user can choose whether they want to filter during
export or during import, or even combine the approaches to export a
subset of the existing resources, and further limit them into smaller
chunks during import.</p>
</li>
</ul>
</section>
<section id="id49">
<h3>Fix<a class="headerlink" href="#id49" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Flavor export/import. [Jiri Stransky]</p>
<p>Flavors were prevented from importing due to several issues around
parameters passed into the flavor creation API request, this is now
fixed. Extra specs are now being set after the flavor is created.</p>
</li>
<li><p>Ensure new security groups don’t have auto-created rules. [Jiri
Stransky]</p>
<p>When creating a security group, OpenStack automatically inserts 2
basic rules to allow all egress traffic (one for IPv4, one for
IPv6). Creating these blanket-allow rules automatically in destination
is undesirable, as the user may have replaced the default rules with
some more restrictive ones in the source security group.</p>
<p>When creating a new destination security group, we now immediately
delete the auto-created rules. If the source security group kept the
default rules, they got exported like any other rules, and will be
imported into destination during rule import.</p>
</li>
<li><p>Skip migration failure cleanup when there is nothing to clean up.
[Jiri Stransky]</p>
<p>Previously the source/destination cleanup would be attempted on a
failed migration, even though the migration didn’t progress far enough
to create the variables that are needed for cleanup. This would then
produce a false alarm error during the cleanup. Now it’s fixed, the
cleanups are attempted only if there is necessary info available (if
the migration progressed far enough for the cleanup to be necessary).</p>
</li>
<li><p>Project sameness handling consistent with other resources. [Jiri
Stransky]</p>
<p>We were missing ‘id’ in project resource and the sameness was
determined by ‘name’. This could run into issues in multi-domain
setups. The sameness check is now consistent with other resources and
is based on ‘id’.</p>
</li>
</ul>
</section>
</section>
<section id="id50">
<h2>0.7.0 (2021-02-18)<a class="headerlink" href="#id50" title="Permalink to this heading"></a></h2>
<section id="id51">
<h3>New<a class="headerlink" href="#id51" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Testing with lower bound requirements. [Jiri Stransky]</p>
<p>We started testing with two OpenStack SDK versions:</p>
<ul class="simple">
<li><p>0.52.x which is close to latest but not yet affected by a security
group rules bug [1].</p></li>
<li><p>0.36.x which is in Train release (OSP 16).</p></li>
</ul>
<p>[1] <a class="reference external" href="https://storyboard.openstack.org/#!/story/2008577">https://storyboard.openstack.org/#!/story/2008577</a></p>
</li>
<li><p>Adds Logic to Unsubscribe RHEL Conversion Hosts. [Ryan Brady]</p>
<p>This patch adds logic to unsubscribe systems from RHSM when using
RHEL as the OS for a conversion host.  The unsubscribe is called
for both the source and destination conversion hosts just before
they are deleted.</p>
</li>
<li><p>Creation of Floating IPs on migrated workloads. [Jiri Stransky]</p>
<p>A new migration parameter ‘floating_ip_mode’ is added into the
workload serialization. The current possible values are ‘auto’ and
‘skip’.</p>
<ul>
<li><p>‘auto’ means that floating IP creation is attempted for the VM, if
the source VM had floating IP(s). The floating IP info is already
being exported with the workload.</p>
<p>Currently we only support auto-assignment of the floating IP
address. (Exact assignment is typically not allowed by policy for
tenants, but this should be investigated too.)</p>
<p>Each floating IP serialization has a ‘floating_network_ref’
reference, which specifies the network where the floating IP should
be created. The ‘fixed_ip_address’ parameter controls which
port/address will the floating IP attach to.</p>
</li>
<li><p>‘skip’ means that even if the workload serialization does include
serialized floating IP subresources, their creation in destination
cloud will not be attempted.</p></li>
</ul>
<p>The ‘floating_ip_mode’ parameter defaults to ‘auto’.</p>
</li>
<li><p>Parallel installation of conversion hosts. [Jiri Stransky]</p>
<p>The updating and installing of packages on conversion hosts can take
minutes. These actions were done in series until now (src then dst),
but now they’re done in parallel, which should speed up execution of
the conversion host deployment playbook.</p>
</li>
<li><p>Floating IP export for workloads (servers) [Jiri Stransky]</p>
<p>When exporting servers, export information about their floating IPs.</p>
</li>
<li><p>Guide for contributing changes to documentation. [Jiri Stransky]</p>
<p>For developers, but also for users who find the docs lacking in some
way. They can either report the issue on Github, or submit a patch
with the changes.</p>
</li>
</ul>
</section>
<section id="id52">
<h3>Changes<a class="headerlink" href="#id52" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Make boot volume prefix configurable, default to ‘os-migrate-’ [Jiri
Stransky]</p>
<p>The boot volume prefix has previously been hard-coded to
‘rhosp-migration-’ and ‘rhosp-migration-root-’, we now make the prefix
configurable via <cite>os_migrate_workload_boot_volume_prefix</cite> variable and
it is defaulted to ‘os-migrate-‘.</p>
</li>
<li><p>Preserve tags during migration of routers, networks, subnets. [Jiri
Stransky]</p>
<p>The tags on networking resources cannot be set during the initial
creation request. Previously we weren’t setting tags at all during
migration of networking resources. We are now migrating tags correctly
on routers, networks and subnets using a post-create/update hook.</p>
</li>
<li><p>Convert to fully qualified collection names. [Carlos Camacho]</p>
<p>Starting on Ansible 2.9 all tasks can use
the fully defined collection name the builtin
runtime is specified in:
<a class="reference external" href="https://github.com/ansible/ansible/blob/devel/lib/ansible/config/ansible_builtin_runtime.yml">https://github.com/ansible/ansible/blob/devel/lib/ansible/config/ansible_builtin_runtime.yml</a></p>
</li>
<li><p>Pass through all RHSM parameters for conversion hosts. [Jiri Stransky]</p>
<p>All parameters supported by the redhat_subscription Ansible module are
now exposed as variables for the conversion host content installation.</p>
</li>
<li><p>Shorter names for RHSM variables. [Jiri Stransky]</p>
<p>The RHSM variables are renamed from previous pattern of
e.g. ‘os_migrate_conversion_host_content_rhsm_user’ to
e.g. ‘os_migrate_conversion_rhsm_user’ which is shorter but should
still be descriptive enough and not risk a naming collision.</p>
<p>The ‘user’ variable is also renamed to ‘username’ to match the
parameter naming on the redhat_subscription module.</p>
</li>
<li><p>Don’t feed availability_zone_hints into requests when empty. [Jiri
Stransky]</p>
<p>The availability_zone_hints parameter for routers and networks can
often be an empty list. Previously we’ve fed it as-is into the API
requests. However, if the extension for network/router availability
zones isn’t enabled, this can cause the request to fail.</p>
<p>We now only use the availability_zone_hints parameter when its not
empty. This should have no effect on correctness, but it can prevent
false-alarm failures.</p>
</li>
<li><p>Resilient RHEL unregistration mechanism. [Jiri Stransky]</p>
<p>Previously the deletion of RHEL conversion hosts would require the
hosts to exist and always execute the unregisteration from RHSM. But
if at least one of the hosts didn’t exist, or the host got somehow
damaged and wasn’t reachable via ssh, the playbook would fail and
would not delete the conversion hosts. The deletion playbook is now
resilient in these scenarios and progresses towards ensuring the
conversion hosts are deleted.</p>
</li>
<li><p>Workload Source Check. [Ryan Brady]</p>
<p>During the workload import, the code was checking the workload status
via the export file.  If a server had been turned on or moved into
another state other than “SHUTOFF” since the export occured, the
workload import would fail.  This patch addresses that by checking
the source cloud via the openstacksdk to ensure the workload status
is “SHUTOFF” before attempting to migrate it.</p>
</li>
</ul>
</section>
<section id="id53">
<h3>Fix<a class="headerlink" href="#id53" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Clean up in the destination cloud after a failed migration. [Jiri
Stransky]</p>
<p>After a workload migration fails, we now clean up any migrated volumes
that are in the destination cloud but weren’t in fact used in creation
of a new server.</p>
</li>
<li><p>Clean up in the source cloud after a failed migration. [Jiri Stransky]</p>
<p>Previously when a migration would fail, the volumes in the source
cloud would remain in incorrect state: boot volume copies still
existing, and all VM’s volumes still attached to conversion host.</p>
<p>This is now fixed - source cloud cleanup is called the same way as
after a successful migration. NBD exports are closed, the duplicated
boot volume is detached from the conversion host and deleted, and any
additional volumes are detached from the conversion host and
re-attached to the source server.</p>
<p>This change also results in module renames:</p>
<ul class="simple">
<li><p><cite>import_workload_source_check</cite> to <cite>import_workload_src_check</cite></p></li>
<li><p><cite>import_workload_cleanup</cite> to <cite>import_workload_src_cleanup</cite></p></li>
</ul>
<p>This is to keep consistent naming of decent length, as src/dst
prefixes are already used elsewhere, and likely we will also introduce
<cite>import_workload_dst_cleanup</cite> module in the future.</p>
</li>
<li><p>Sparsification of volumes. [Jiri Stransky]</p>
<p>To have the volume sparsification work, two things have changed:</p>
<ul class="simple">
<li><p>We install and start libvirt in the conversion hosts.</p></li>
<li><p>We specify that the NBD backends of volume qcow2 images are of raw
format.</p></li>
</ul>
</li>
<li><p>Exact name match on idempotency check during workload migration. [Jiri
Stransky]</p>
<p>Previously we just fed the desired server_name into the
<cite>compute.servers()</cite> query when checking whether a server has already
been migrated. However, Nova API performs a regular expression search,
so this condition matched on any substring occurence. This is now
fixed by wrapping the search term between ^ and $.</p>
<p>Note: We use Glance API in a similar way due to it also not having a
find method with project filters. Glance API seems to do exact
matching on the name query.</p>
</li>
<li><p>Compatibility with OpenStack SDK 0.36.x. [Jiri Stransky]</p>
<p>It seems like the only place we’re hitting problems is using ‘owner’
property of an image resource. Both 0.36 and 0.52 SDK support the
‘owner_id’ property there, so let’s just use that.</p>
<p>Interestingly enough, this is not the case for the query parameters in
<cite>conn.image.images()</cite>. There <cite>image_id</cite> is not working anywhere, it
has to be <cite>image</cite> in both 0.36 and 0.52, so we’ll stick to that.</p>
</li>
<li><p>Loosen OpenStack operation timeouts in workload migration. [Jiri
Stransky]</p>
<p>The current timeout for OpenStack operations during workload migration
is 10 minutes. This can be too short when working with large storage
volumes. We should make the timeout configurable, but as first
alleviation we increase the timeout to 30 minutes. This should still
be enough to fail in reasonable time when things get stuck, but it
shouldn’t produce as many false alarms.</p>
</li>
<li><p>Always stop on errors in conversion host deployment. [Jiri Stransky]</p>
<p>Previously when the source or destination conversion host encountered
some errror, Ansible would mark that host as failed and not run any
other tasks there, but it would continue to run tasks on other hosts,
most notably the migrator. This meant that e.g. subscription errors
wouldn’t stop the playbook immediately, and if conversion host
deployment was included into a more complex migration playbook, the
migration itself would fail much later with a non-obvious error. This
is now fixed: whenever an error during conversion host deployment
happens, the playbook stops right away.</p>
</li>
<li><p>Fix image lookup for images owned by tenant. [Jiri Stransky]</p>
<p>The <cite>connection.image.find_image</cite> method doesn’t support filter
arguments (like project_id), unlike other find methods. This caused
failures when looking up images to be used for servers, when the image
was owned by tenant (non-public).</p>
<p>A custom image lookup method is now implemented in our reference.py
module, utilizing <cite>images()</cite> rather than <cite>find_image()</cite>.</p>
<p>End-to-end tests are also amended to test one workload spawned from
public image, and one from tenant-owned image.</p>
</li>
<li><p>Do not look up server image when boot_disk_copy: true. [Jiri Stransky]</p>
<p>When migrating a server which is boot-from-image in source cloud, and
boot-from-volume in destination cloud (due to setting <cite>boot_disk_copy:
true</cite>), the server creation would still try to look up <cite>image_ref</cite> in
the destination cloud, and fail if the image doesn’t exist.</p>
<p>This is now fixed. With <cite>boot_disk_copy: true</cite> we don’t need any
images in destination, so we no longer perform an image lookup.</p>
</li>
<li><p>Fix building OS Migrate from source. [Jiri Stransky]</p>
<p>The conditional for sourcing virtualenv was incorrect in the script,
and virtualenv wasn’t being sourced automatically. This is now fixed
for users who want to build OS Migrate from source via the toolbox
container.</p>
</li>
</ul>
</section>
<section id="id54">
<h3>Other<a class="headerlink" href="#id54" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Oth: Documentation for using RHEL as conversion host. [Jiri Stransky]</p></li>
<li><p>Oth: Documentation for ‘floating_ip_mode’ workload migration
parameter. [Jiri Stransky]</p></li>
<li><p>Pin openstacksdk version due to os_security_group_rule module
breakage. [Jiri Stransky]</p>
<p>The pin works around this breakage:</p>
<p>‘BadRequestException: 400: Client Error for url:
<a class="reference external" href="http://10.0.110.233:9696/v2.0/security-group-rules">http://10.0.110.233:9696/v2.0/security-group-rules</a>, Unrecognized
attribute(s) ‘’remote_address_group_id’’’</p>
<p>It seems like remote_address_group_id is fed into the request even
though we’re not specifying it, which makes the os_security_group_rule
module incompatible with Train release and lower.</p>
</li>
<li><p>Docs: include information in all roles. [Carlos Camacho]</p></li>
<li><p>Update packages when deploying conversion hosts. [Jiri Stransky]</p>
<p>I ran into a bug when trying to migrate workloads, the volume export
step crashed with:</p>
<p>qemu-img: Unable to initialize gcrypt</p>
<p>It turns out there was desync in package versions, we were installing
latest qemu-img but libgcrypt was old. We need to update to latest
when deploying the conversion hosts.</p>
</li>
</ul>
</section>
</section>
<section id="id55">
<h2>0.6.2 (2021-01-28)<a class="headerlink" href="#id55" title="Permalink to this heading"></a></h2>
<section id="id56">
<h3>Fix<a class="headerlink" href="#id56" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Always stop on errors in conversion host deployment. [Jiri Stransky]</p>
<p>Previously when the source or destination conversion host encountered
some errror, Ansible would mark that host as failed and not run any
other tasks there, but it would continue to run tasks on other hosts,
most notably the migrator. This meant that e.g. subscription errors
wouldn’t stop the playbook immediately, and if conversion host
deployment was included into a more complex migration playbook, the
migration itself would fail much later with a non-obvious error. This
is now fixed: whenever an error during conversion host deployment
happens, the playbook stops right away.</p>
<p>(cherry picked from commit e867b359371d3bfc250b45e4c9e176b3d020d37c)</p>
</li>
<li><p>Loosen OpenStack operation timeouts in workload migration. [Jiri
Stransky]</p>
<p>The current timeout for OpenStack operations during workload migration
is 10 minutes. This can be too short when working with large storage
volumes. We should make the timeout configurable, but as first
alleviation we increase the timeout to 30 minutes. This should still
be enough to fail in reasonable time when things get stuck, but it
shouldn’t produce as many false alarms.</p>
<p>(cherry picked from commit 790a44059e15632c4ac008ba3639700238c4b98f)</p>
</li>
<li><p>Fix image lookup for images owned by tenant. [Jiri Stransky]</p>
<p>The <cite>connection.image.find_image</cite> method doesn’t support filter
arguments (like project_id), unlike other find methods. This caused
failures when looking up images to be used for servers, when the image
was owned by tenant (non-public).</p>
<p>A custom image lookup method is now implemented in our reference.py
module, utilizing <cite>images()</cite> rather than <cite>find_image()</cite>.</p>
<p>End-to-end tests are also amended to test one workload spawned from
public image, and one from tenant-owned image.</p>
<p>Resolves: <a class="reference external" href="https://github.com/os-migrate/os-migrate/issues/346">https://github.com/os-migrate/os-migrate/issues/346</a>
(cherry picked from commit 24d383dd1373bc4e09210f56b85052c57338583c)</p>
</li>
<li><p>Do not look up server image when boot_disk_copy: true. [Jiri Stransky]</p>
<p>When migrating a server which is boot-from-image in source cloud, and
boot-from-volume in destination cloud (due to setting <cite>boot_disk_copy:
true</cite>), the server creation would still try to look up <cite>image_ref</cite> in
the destination cloud, and fail if the image doesn’t exist.</p>
<p>This is now fixed. With <cite>boot_disk_copy: true</cite> we don’t need any
images in destination, so we no longer perform an image lookup.</p>
<p>Resolves: <a class="reference external" href="https://github.com/os-migrate/os-migrate/issues/347">https://github.com/os-migrate/os-migrate/issues/347</a>
(cherry picked from commit 5a57a52778a8668b5ca1b2787b5cc89d221d4449)</p>
</li>
</ul>
</section>
<section id="id57">
<h3>Other<a class="headerlink" href="#id57" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Prepare release 0.6.2. [Jiri Stransky]</p></li>
<li><p>Pin openstacksdk version due to os_security_group_rule module
breakage. [Jiri Stransky]</p>
<p>The pin works around this breakage:</p>
<p>‘BadRequestException: 400: Client Error for url:
<a class="reference external" href="http://10.0.110.233:9696/v2.0/security-group-rules">http://10.0.110.233:9696/v2.0/security-group-rules</a>, Unrecognized
attribute(s) ‘’remote_address_group_id’’’</p>
<p>It seems like remote_address_group_id is fed into the request even
though we’re not specifying it, which makes the os_security_group_rule
module incompatible with Train release and lower.</p>
<p>Resolves: <a class="reference external" href="https://github.com/os-migrate/os-migrate/issues/350">https://github.com/os-migrate/os-migrate/issues/350</a>
(cherry picked from commit 9e1109c57326c728486d85f4c6774f89bfef7710)</p>
</li>
</ul>
</section>
</section>
<section id="id58">
<h2>0.6.1 (2020-12-10)<a class="headerlink" href="#id58" title="Permalink to this heading"></a></h2>
<ul>
<li><p>Update packages when deploying conversion hosts. [Jiri Stransky]</p>
<p>I ran into a bug when trying to migrate workloads, the volume export
step crashed with:</p>
<p>qemu-img: Unable to initialize gcrypt</p>
<p>It turns out there was desync in package versions, we were installing
latest qemu-img but libgcrypt was old. We need to update to latest
when deploying the conversion hosts.</p>
<p>Resolves: <a class="reference external" href="https://github.com/os-migrate/os-migrate/issues/322">https://github.com/os-migrate/os-migrate/issues/322</a>
(cherry picked from commit 3e68a4aad182472d8d343769c83640512551a673)</p>
</li>
</ul>
</section>
<section id="id59">
<h2>0.6.0 (2020-11-25)<a class="headerlink" href="#id59" title="Permalink to this heading"></a></h2>
<section id="id60">
<h3>New<a class="headerlink" href="#id60" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Documentation for resource filters. [Jiri Stransky]</p></li>
<li><p>Guide for using migration parameters. [Jiri Stransky]</p></li>
<li><p>Include changelog in docs. [Carlos Camacho]</p>
<p>This patch includes the changelog in the documentation automatically.</p>
</li>
</ul>
</section>
<section id="id61">
<h3>Changes<a class="headerlink" href="#id61" title="Permalink to this heading"></a></h3>
<ul>
<li><p>User documentation improvements. [Jiri Stransky]</p>
<p>Improve clarity of user docs in various spots and add more workload
migration info to the walkthrough doc.</p>
</li>
<li><p>Take info about server ports from Neutron. [Jiri Stransky]</p>
<p>Previously we took it from Nova but that does not contain all the
needed info for advanced use cases. Now we export info from Neutron
which should allow us to export more port properties.</p>
<p>The creation of ports during server import is still kept simple for
now, via Nova. This has the benefit that if the server is deleted
later, its ports are deleted automatically too. We may add an opt-in
advanced port creation method via Neutron to support additional
properties (e.g. setting a MAC address). However, IIUC, the ports
created via Neutron don’t get automatically deleted on server deletion
and have to be cleaned up afterwards.</p>
</li>
<li><p>More metadata to migrate with servers. [Jiri Stransky]</p></li>
</ul>
</section>
<section id="id62">
<h3>Fix<a class="headerlink" href="#id62" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Detach stuck volumes in unit tests. [Jiri Stransky]</p></li>
<li><p>Revert to conditional empty variable check. [Carlos Camacho]</p>
<p>Im following now the same approach we have in another
variables check in the same makefile.
Even if locally the check works in the job we have
errors like: if [[ EUSE_TOOLBOX -eq “0” ]]; then Notice that EUSE instead or REUSE</p>
</li>
<li><p>Assign a default value for reusing the toolbox image. [Carlos Camacho]</p>
<p>Currently, the container image build job is failing
as we are calling the toolbox build without the
variable TOOLBOX_BUILD. This patch defaults the value to 0
if not defined, which means, build the container image.</p>
</li>
</ul>
</section>
<section id="id63">
<h3>Other<a class="headerlink" href="#id63" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Update contributing.rst. [Ryan Brady]</p>
<p>minor edit, changed titles to title case</p>
</li>
<li><p>Move resource checks from utility to Resource classes. [Ryan Brady]</p>
<p>This patch moves the responsibility of comparing resources from
the serialization class into the Resource class hierarchy so subclasses
can add custom comparisons as needed.</p>
</li>
<li><p>Store workload migration logs in a separate dir. [Jiri Stransky]</p>
<p>Previously workload migration logs were stored directly in
os_migrate_data_dir together with resource YAMLs. This meant that when
migrating multiple workloads, the directory would get cluttered. Let’s
separate workload migration logs into its own directory.</p>
</li>
<li><p>Reuse container images if possible. [Carlos Camacho]</p></li>
<li><p>Preserve keypair when creating a server from an image. [Jiri Stransky]</p>
<p>This will ensure ssh-ability of servers which were migrated using the
from-image method. Naturally the ssh keypair needs to be migrated
before migrating the server.</p>
</li>
<li><p>Migration of rebuildable servers. [Jiri Stransky]</p>
<ul class="simple">
<li><p>This enables the boot_disk_copy migration parameter for
workloads. When it’s <cite>false</cite>, server is booted from an image. When
it’s <cite>true</cite>, server boot disk is copied and the destination
server is created as boot-from-volume.</p></li>
<li><p>Default value for boot_disk_copy depends on each server. Servers
booted from a volume default to <cite>true</cite> (as that is the only sensible
option), servers booted from an image default to <cite>false</cite>.</p></li>
<li><p><cite>image_ref</cite> is added to the server serialization to track the Glance
image that should be used to create the server.</p></li>
<li><p>E2e tests for workload migration are now testing these cases:</p>
<ul>
<li><p>Instance booted from an image, with boot_disk_copy: false.</p></li>
<li><p>Instance booted from an image, with boot_disk_copy: true.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Add migration param defaults to the resource class. [Jiri Stransky]</p>
<p>This will allow us to assume that some keys exist in the migration
params. We won’t have to check for their existence before using them
in code.</p>
</li>
<li><p>Specify the image format. [Carlos Camacho]</p></li>
<li><p>Create servers using proper Nova bindings, support server description.
[Jiri Stransky]</p>
<p>This commit moves us off old bindings for server creation onto the
current ones. Points of interest:</p>
<ul class="simple">
<li><p>Only <cite>block_device_mapping</cite> is now used for all volumes, we can get
rid of special handling for <cite>boot_volume_id</cite>.</p></li>
<li><p>We can and do support the <cite>description</cite> parameter on servers.</p></li>
<li><p>The move forced changes in how we specify security groups and NICs
but we still support the important features we supported before,
e.g. fixed IP preservation.</p></li>
<li><p>In general this enable us to support more Nova API features /
instance parameters.</p></li>
</ul>
</li>
<li><p>Resilience in e2e cleaning against failed migrations. [Jiri Stransky]</p>
<p>If workload migration fails, volumes might still be attached to the
conversion host(s) which prevents them from being deleted. Make sure
they are detached before deleting.</p>
</li>
<li><p>Stop busy-looping during volume transfer (fix for 100% CPU usage)
[Jiri Stransky]</p>
<p>The EAGAIN error code is used when polling, meaning there’s no data to
read right now but it should be tried again later. Instead of trying
right away, sleep for a second. This will prevent Ansible from eating
100% CPU on the migrator machine.</p>
</li>
<li><p>Add Tenant(Project) Roles. [Ryan Brady]</p>
<p>This patch adds the roles and supporting code to import and export
OpenStack projects.</p>
</li>
<li><p>Use an additional non-boot volume in e2e workload tests. [Jiri
Stransky]</p>
<p>This should improve our test coverage, only instance with no attached
volumes was tested until now.</p>
</li>
<li><p>Fix non-boot volume attachement. [Jiri Stransky]</p>
<p>After migrating, the additional non-boot volume didn’t attach onto the
instance correctly, instead it was stuck in “reserved”. This was due
to malformed block_device_mapping_v2 data structure. See docs [1].</p>
</li>
<li><p>Include lint checks. [Carlos Camacho]</p></li>
<li><p>Export/import users with functional tests. [Carlos Camacho]</p></li>
<li><p>Adjust docs job and build nightly image. [Carlos Camacho]</p></li>
</ul>
</section>
</section>
<section id="id64">
<h2>0.5.0 (2020-10-02)<a class="headerlink" href="#id64" title="Permalink to this heading"></a></h2>
<ul>
<li><p>Add missing role readme files. [Jiri Stransky]</p>
<p>Galaxy releasing fails without these.</p>
</li>
<li><p>Release 0.5.0. [Jiri Stransky]</p></li>
<li><p>Separates Functional Tests into Admin/Tenant. [Ryan Brady]</p>
<p>This patch changes the func tests to run separately for both admin
and tenant roles.  It follows the pattern done for the e2e testing
a short time ago.</p>
</li>
<li><p>Allow running e2e tests in smaller chunks for development. [Jiri
Stransky]</p>
<p>Currently running e2e tests does all this: deploy conversion hosts,
seed pre-workload resources, then workload resources, then migrate
pre-workload, then migrate workload, then clean everything up.</p>
<p>For working on workload migration, it would be great if we could leave
conversion hosts and pre-workload resources in place between test
runs, and only cycle seed-migrate-clean on the actual workload. This
is now implemented, but the default test run remains unchanged.</p>
<p>First i can just run everything without cleaning up:</p>
<p>./toolbox/run bash -c “E2E_TEST_ARGS=’–skip-tags test_clean_after -e test_clean_conversion_hosts_after=false’ make test-e2e-tenant”</p>
<p>And then i can run workload tests specifically, which will auto-clean
before and after, but only the workload parts:</p>
<p>./toolbox/run bash -c “E2E_TEST_ARGS=’–tags test_workload’ make test-e2e-tenant”</p>
</li>
<li><p>Put e2e scenario variables last. [Jiri Stransky]</p>
<p>This allows them to also override the auth file, if desired.</p>
</li>
<li><p>Add ‘boot_disk_copy’ migration parameter to workloads. [Jiri Stransky]</p>
<p>Default it to true for now, as currently that’s the only supported
migration method.</p>
</li>
<li><p>Move server creation logic into the resource class. [Jiri Stransky]</p></li>
<li><p>Add _migration dict into resource serialization. [Jiri Stransky]</p>
<p>Currently we have two dicts within the resource serialization:</p>
<ul class="simple">
<li><p>params - parameters relevant for resource creation in destination
cloud, and for idempotence,</p></li>
<li><p>_info - additional information about the resource from source cloud,
which will not be passed on into the destination cloud when creating
the resource.</p></li>
</ul>
<p>With work on migration of rebuildable instances, we will add a third one:</p>
<ul class="simple">
<li><p>_migration - parameters for the migration process itself, not
capturing properties of the resource, but rather <em>how</em> we want the
resource to be migrated.</p></li>
</ul>
<p>The example use case here is the workload migration. There is one
server in the source cloud but we have at least two options how to
move it to destination:</p>
<ul class="simple">
<li><p>full copy (current method) - root disk is copied as a volume, and
the instance in the destination cloud is booted from that volume,</p></li>
<li><p>rebuild (to be implemented) - instance is booted from the same
glance image in the destination cloud, putting the destination
instance into a similar state as after using <cite>openstack server
rebuild</cite> on the original. This is better suited for instances which
are stateless or only save state on external volumes, not on the
root disk.</p></li>
</ul>
<p>To distinguish how we want a given server migrated, we will have a
parameter in the _migration section.</p>
</li>
<li><p>Update wrong links. [Carlos Camacho]</p></li>
<li><p>Foundation for running e2e tests as admin. [Jiri Stransky]</p></li>
<li><p>Use separate tmp dir for e2e tests. [Jiri Stransky]</p></li>
<li><p>Split file paths to prepare separate e2e tenant/admin tests. [Jiri
Stransky]</p></li>
<li><p>Prefix and shorten export variable names. [Jiri Stransky]</p>
<p>We had a bunch of unprefixed variables like:</p>
<p>export_networks_name_filter</p>
<p>We should add the os_migrate prefix and we can perhaps shorten the
variable name to still remain descriptive enough, like this:</p>
<p>os_migrate_networks_filter</p>
<p>The rename in this sense is applied across the project to all affected
variables.</p>
<p>This rename also opens up the possibility to use this filter on
imports in the future, allowing to work on full YAML files while
selecting just a few resources to import. It cannot be done right now
because the stringfilter module only supports looking at direct
attribute and not nested ones, so we cannot look at [‘params’][‘name’]
presently. An enhancement for stringfilter could be implemented.</p>
</li>
<li><p>Allow setting conversion subnet DNS separately for src/dst. [Jiri
Stransky]</p>
<p>DNS nameservers is a parameter for conversion subnet where it makes
sense to allow different values between src/dst clouds.</p>
</li>
<li><p>Fix readme and include a link to the project in the docs root. [Carlos
Camacho]</p></li>
<li><p>Filter exported images by the currently authenticated project. [Jiri
Stransky]</p>
<p>This kind of filtering is standard for our other resources, but for
Glance images it was missing due to Glance API lack of functionality
which translates into lack of functionality in the os_image_info
Ansible module. The filtering is done explicitly in the playbook now.</p>
</li>
<li><p>Docs refactor. [Carlos Camacho]</p></li>
<li><p>(WIP) Adds Nova Idempotence Tests. [Ryan Brady]</p>
<p>This patch adds idempotence tests for the Nova Flavor and Keypair
resources.</p>
</li>
<li><p>Include the fixed IP when restoring the server. [Carlos Camacho]</p>
<p>The nics parameter is not documented in the upstream
docs, also there is no way in inject the MAC address,
or assign the floating IP when executing create_server</p>
<p>This should be fixed by creating a port and assign it
to the node before is created.</p>
</li>
<li><p>Walkthrough doc updates and formatting fixes. [Jiri Stransky]</p>
<p>This makes walkthrough doc up to date and generally into a better
shape. Some notable changes:</p>
<ul class="simple">
<li><p>Prerequisites section regarding authentication and parameters which
are used for both pre-workload and workload migration is
consolidated and moved at the beginning of the doc.</p></li>
<li><p>Nesting of headlines is fixed.</p></li>
<li><p>Removed mentions RH OSP.</p></li>
<li><p>Updated conversion host deployment to use the playbook instead of
manual wiring instructions.</p></li>
<li><p>Updated the workload migration process to the new one which runs on
plain CentOS and doesn’t require VDDK.</p></li>
<li><p>Command shortcuts.</p></li>
</ul>
</li>
<li><p>Adds Roles For Nova Keypair Import and Export. [Ryan Brady]</p>
<p>This patch adds the roles and associated code required to export
and import Nova keypairs.</p>
</li>
<li><p>Add an update test for images. [Jiri Stransky]</p></li>
<li><p>Add idempotence tests for image export/import. [Jiri Stransky]</p></li>
<li><p>Implement Glance image import. [Jiri Stransky]</p></li>
<li><p>Fix pylint issues. [Jiri Stransky]</p>
<p>It seems like pylint got updated and our code started failing the
lint, this is now fixed.</p>
</li>
<li><p>Adds Import and Export Roles for Nova Flavors. [Ryan Brady]</p>
<p>This patch adds import and export roles, supporting files and tests
for migrating Nova Flavors between clouds.</p>
</li>
<li><p>Adds Nova services to the CI stack. [Ryan Brady]</p>
<p>This patch adds the nova services to the stack to support functional
tests.</p>
</li>
<li><p>Export of Glance images. [Jiri Stransky]</p>
<p>Since Glance images contain binary data, the export is done via two
modules:</p>
<ul class="simple">
<li><p>export_image_meta – exports image metadata (YAML file)</p></li>
<li><p>export_image_blob – exports image binary data</p></li>
</ul>
<p>The export of binary data is optional. This split between metadata and
data exporting should leave us an open door towards migrating images
in a direct way between clouds (e.g. via conversion hosts) rather than
via the migrator host.</p>
</li>
<li><p>Update user docs to use Keystone v2. [Carlos Camacho]</p></li>
<li><p>Support migrations between keystone v2 and v3. [Carlos Camacho]</p></li>
<li><p>Update references from ‘master’ branch to ‘main’ [Jiri Stransky]</p></li>
<li><p>Allow configure the ssh user. [Carlos Camacho]</p></li>
<li><p>These are the pending changes to allow using the centos image. [Carlos
Camacho]</p>
<p>We use become from vars and include internal DNS to
be able to install packages.</p>
<p>We also increase the timeout to create the conversion hosts to
10 minutes, and change the default image to be CentOS.</p>
</li>
<li><p>Adds Role to Install Conversion Host Content. [Ryan Brady]</p>
<p>This patch adds a role to install content for the conversion host
conditionally.  The role currently supports CentOS and RHEL but
is written in a way that should be simple to add additional OS
support if needed in the future.</p>
</li>
<li><p>Adds Link For Contributing To Developer Doc. [Ryan Brady]</p>
<p>Adds a link for the the contributing doc to the README.</p>
</li>
<li><p>Adds Contribution Document. [Ryan Brady]</p>
<p>This patch adds information to help a potential contributor add
new roles or supporting code to the project.</p>
</li>
<li><p>Fixes Walkthrough Images. [Ryan Brady]</p>
<p>When the walkthrough doc was merged, the URIs for the images were
incorrect and the images were not displayed for users.  This patch
fixes the URIs for the images to the correct path and removed an
erroneous TODO comment left in the previous version.</p>
</li>
<li><p>Fully qualified refs in workload serialization. [Jiri Stransky]</p></li>
<li><p>Add Matthew into authors. [Jiri Stransky]</p></li>
<li><p>Use cgroupfs as cgroup manager in Github Actions. [Jiri Stransky]</p></li>
<li><p>Format variable names as code. [Jiri Stransky]</p></li>
<li><p>Restructure user documentation landing page. [Jiri Stransky]</p>
<p>Remove the walkthrough-like part of the root user readme, we have a
specific Walkthrough doc now. Make the main readme a link directory.</p>
</li>
<li><p>Configuring the conversion host. [Carlos Camacho]</p></li>
<li><p>Fully qualified refs in network serialization. [Jiri Stransky]</p></li>
<li><p>Fully qualified refs in security groups and rules serialization. [Jiri
Stransky]</p></li>
<li><p>Fully qualified refs in router and router interface serialization.
[Jiri Stransky]</p></li>
<li><p>Fully qualified refs in subnet serialization. [Jiri Stransky]</p></li>
<li><p>Adds Walkthrough Document. [Jiri Stransky, Matthew Arnold, Ryan Brady]</p>
<p>This patch adds documentation for executing a parallel cloud migration
using os-migrate.</p>
</li>
<li><p>Fix. [Carlos Camacho]</p></li>
<li><p>Improve variable naming consistency in conversion host playbook. [Jiri
Stransky]</p></li>
</ul>
</section>
<section id="id65">
<h2>0.4.1 (2020-06-26)<a class="headerlink" href="#id65" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Prepare release of 0.4.1. [Jiri Stransky]</p></li>
<li><p>Fix. [Carlos Camacho]</p></li>
</ul>
</section>
<section id="id66">
<h2>0.4.0 (2020-06-26)<a class="headerlink" href="#id66" title="Permalink to this heading"></a></h2>
<ul>
<li><p>Prepare release 0.4.0. [Jiri Stransky]</p>
<p>Mainly utilizes a new workload migration approach with new conversion
host and conversion host deployment/deletion playbooks.</p>
</li>
<li><p>Fix subnet update test. [Jiri Stransky]</p>
<p>The lineinfile module only makes sure one line is present. So after it
does its replacement in one spot, it stops replacing. Due to random
order of subnets in the file, it sometimes replaces the description of
the wrong subnet, resulting in intermittent failures. To make the
tests work, we simply replace descriptions of both subnets in the func
test, and then we check only one.</p>
<p>To keep tests consistent, use ‘replace’ instead of ‘lineinfile’ module
in other tests too.</p>
</li>
<li><p>Variables cleanup. [Carlos Camacho]</p>
<p>This patch makes the variables used in the
configurable so we can trigger different scenarios
just changing this default file.</p>
<p>Also separates the network/flavor/image names for
src/dst conversion hosts</p>
<p>And remove some required variables that can be safely
defaulted.</p>
</li>
<li><p>Adds Functional Update Test for Security Groups. [Ryan Brady]</p>
<p>This patch adds a test to ensure the updates for security group
resources is working properly.</p>
</li>
<li><p>Adds Update Functional Tests for Subnets. [Ryan Brady]</p>
<p>This patch adds the code to test the update functionality of the
subnet resources.</p>
</li>
<li><p>Adds Functional Test for Network Update. [Ryan Brady]</p>
<p>This patch adds a functional test to ensure that updates are working
for the network resource.</p>
</li>
<li><p>Adds Functional Update Test For Router Resources. [Ryan Brady]</p>
<p>This patch adds a test to ensure updates work for router resources.</p>
</li>
<li><p>Use conversion host deployment/deletion playbooks in CI. [Jiri
Stransky]</p></li>
<li><p>Set up conversion hosts to talk to each other. [Jiri Stransky]</p>
<p>A separate ssh key is used to connect from dst conversion host to src
conversion host, so that user can’t mistakenly upload their own
private key into the conversion host.</p>
</li>
<li><p>Fix Resource Updates. [Jiri Stransky, Ryan Brady]</p>
<p>For the resources that support updating, the code previously called
the update sending the resource name causing the update to fail
from the corresponding API with a “BadRequest” error.  This patch
updates the code to use the instance of the resource itself when
calling the associated update method.</p>
</li>
<li><p>Hack for conversion host reachability in CI. [Jiri Stransky]</p></li>
<li><p>Update workload exporting for new openstacksdk. [Jiri Stransky]</p></li>
<li><p>Make sure we respect virtualenv in playbooks. [Jiri Stransky]</p>
<p>When we run our playbooks, it seems that virtualenv is ignored even
when it’s active for the ansible-playbook command invocation. We set
it into the inventory explicitly, so that when venv is active for
ansible-playbook invocation, it will also be active for the Ansible
modules invocations.</p>
</li>
<li><p>Print whether we’re sourcing venv or not in Makefile. [Jiri Stransky]</p></li>
<li><p>Fix timeout logic on snapshot creation. [Jiri Stransky]</p>
<p>In CI we’re hitting this error:</p>
<blockquote>
<div><p>File “/tmp/ansible_os_migrate.os_migrate.import_workload_export_volumes_payload_4g3ps56s/ansible_os_migrate.os_migrate.import_workload_export_volumes_payload.zip/ansible_collections/os_migrate/os_migrate/plugins/modules/import_workload_export_volumes.py”, line 364, in _detach_data_volumes_from_source
AttributeError: ‘NoneType’ object has no attribute ‘id’</p>
</div></blockquote>
<p>Looks like the call to create snapshot returns None. We’ll try moving
the timeout into the call itself and using wait=True.</p>
</li>
<li><p>Add playbooks for deployment and deletion of conversion hosts. [Jiri
Stransky]</p>
<p>Deploys and deletes the conversion hosts including supporting
resources like networking, security group, and key pair. The
deployment and deletion are within a single role to make use of common
defaults file.</p>
</li>
<li><p>Relax YAML lint - allow 100 character lines. [Jiri Stransky]</p>
<p>The 80 character limit is a bit too strict for dealing with long
Ansible variables. 100 characters should still be comfortable enough
for modern screens.</p>
</li>
<li><p>Update uch image. [Carlos Camacho]</p></li>
<li><p>Gitignore local directory. [Jiri Stransky]</p>
<p>This directory allows putting some personal files in, e.g. credential
or parameter files for manual testing. This directory is available in
<cite>./toolbox/venv-shell</cite> containers.</p>
</li>
<li><p>Use nbdkit if available with fallback to qemu-nbd. [Matthew Arnold]</p></li>
<li><p>Clean up temporary volumes and SSH processes. [Matthew Arnold]</p></li>
<li><p>Create destination instance and attach volumes. [Matthew Arnold]</p>
<p>Also add number/names of networks, without preserving MAC addresses.</p>
</li>
<li><p>Transfer exported volumes to destination. [Matthew Arnold]</p>
<p>Also factor out common code between source and destination conversion hosts.</p>
</li>
<li><p>Export volumes from source conversion host. [Matthew Arnold]</p></li>
<li><p>Fix exporting router interfaces when router name filter is undefined.
[Jiri Stransky]</p>
<p>Just a missing default.</p>
<p>Closes <a class="reference external" href="https://github.com/os-migrate/os-migrate/issues/201">https://github.com/os-migrate/os-migrate/issues/201</a></p>
</li>
<li><p>Docs for publishing a release. [Jiri Stransky]</p></li>
<li><p>Make sure that docs CI passes ‘functional’ test automatically too.
[Jiri Stransky]</p>
<p>Without this a pull request seems to be able to get stuck waiting for
the functional test to complete.</p>
</li>
</ul>
</section>
<section id="id67">
<h2>0.3.1 (2020-06-05)<a class="headerlink" href="#id67" title="Permalink to this heading"></a></h2>
<ul>
<li><p>Prepare release 0.3.1. [Jiri Stransky]</p></li>
<li><p>Fix exporting router interfaces when router name filter is undefined.
[Jiri Stransky]</p>
<p>Just a missing default.</p>
<p>Closes <a class="reference external" href="https://github.com/os-migrate/os-migrate/issues/201">https://github.com/os-migrate/os-migrate/issues/201</a></p>
<p>(cherry picked from commit fc81f87d147980aae45f205959d42628885f4b36)</p>
</li>
</ul>
</section>
<section id="id68">
<h2>0.3.0 (2020-06-02)<a class="headerlink" href="#id68" title="Permalink to this heading"></a></h2>
<ul>
<li><p>Add readme files to all roles, pointing to user docs. [Jiri Stransky]</p>
<p>It looks like this is now required, otherwise the Galaxy publish
script fails with:</p>
<p>ERROR! Galaxy import process failed: No role readme found. (Code: None)</p>
</li>
<li><p>Prepare the release of 0.3.0. [Jiri Stransky]</p></li>
<li><p>Adds additional user docs. [Ryan Brady]</p>
<p>This patch adds more data to the repo README and updates the
the user doc to remove clouds.yml info and replace it with
the newer auth vars.</p>
</li>
<li><p>Reintroduce project filtering into workload migration idempotence
check. [Jiri Stransky]</p>
<p>This was added earlier but errorneously, reporting that server exists
even if it wasn’t true, so it had to be reverted. The project id
filtering is now reintroduced into the workload migration idempotence
check, and it doesn’t produce false positives.</p>
</li>
<li><p>Include the workload migration. [Carlos Camacho]</p></li>
<li><p>Add dst filters to workload migration. [Jiri Stransky]</p>
<p>This is only necessary when looking up the conversion host and when
checking for idempotence. The actual workload migration uses the VM’s
ID from _info, so it should be already good to go:</p>
<p><a class="reference external" href="https://github.com/os-migrate/os-migrate/blob/2aa04ad4c2cf6d1e8abb24f845c7c9009fcd58fd/os_migrate/plugins/modules/import_workload_prelim.py#L297">https://github.com/os-migrate/os-migrate/blob/2aa04ad4c2cf6d1e8abb24f845c7c9009fcd58fd/os_migrate/plugins/modules/import_workload_prelim.py#L297</a></p>
</li>
<li><p>Include network mappings in wrapper input. [Matthew Arnold]</p></li>
<li><p>Import lookups filtering by project_id for pre-workload migration.
[Jiri Stransky]</p></li>
<li><p>Rename export_prelude role to prelude_src. [Jiri Stransky]</p>
<p>I realized that e.g. workload import might need to fetch authenticated
project IDs for both src and dst. Rather than having an export/import
prelude, it may make more sense to have prelude roles for interacting
with src/dst clouds.</p>
</li>
<li><p>Add project id filter to the remaining export roles. [Jiri Stransky]</p>
<p>By default, make sure we export only resources in the currently
autheticated project.</p>
</li>
<li><p>Remove unused (and incorrect) os_security_group_rules_info. [Jiri
Stransky]</p>
<p>This isn’t used and it’s not utilizing the filters parameter correctly.</p>
</li>
<li><p>Implement export filter for resources in current project (for
networks) [Jiri Stransky]</p>
<p>This adds the reusable code for fetching current project ID and
setting a general export filter with that project ID by
default. Networks export is amended to make use of this filtering
parameter.</p>
</li>
<li><p>Adds test for Router Interface idempotence. [Ryan Brady]</p>
<p>This patch adds a test to ensure router interface idempotence and
updates the router interface resource class to handle the case
when a router interface already exists when attempting to create
an identical one.</p>
<p>This patch also fixes a small bug in the router interface where
it was using the “subnet_name” key where it should have been
using a “subnet_id” key.  This was causing the unintended behavior
of never finding a matching port when checking for ports that may
have already been created, so it always tried to create the port
leading to conflicts.</p>
</li>
<li><p>Capture wrapper stdout/stderr to data directory. [Matthew Arnold]</p></li>
<li><p>Split import_workload into two modules. [Matthew Arnold]</p>
<p>The ‘prelim’ module configures everything right up to the point of
running the virt-v2v-wrapper container, and returns paths to the
expected log and state files at that point. The import_workload module
just runs the container, so it will still sit without showing progress
for potentially a very long time - but this way the operator can
optionally monitor the previously-provided log files as needed.</p>
</li>
<li><p>Ansible automation for the e2e tests. [Carlos Camacho]</p></li>
<li><p>Adds Functional Test for Security Group Rule Idempotence. [Ryan Brady]</p>
<p>This patch adds a functional test to ensure security group rule idempotence.</p>
</li>
<li><p>Make sure releasing is done from toolbox container. [Jiri Stransky]</p>
<p>E.g. if shyaml is missing, the releasing will fail with a weird
error. In toolbox, we have all the releasing dependencies.</p>
</li>
<li><p>Prepare for 0.0.2 release to Galaxy. [Jiri Stransky]</p></li>
<li><p>First attempt at workload migration. (#170) [Matthew Arnold]</p>
<p>First attempt at workload migration.</p>
<p>This runs virt-v2v-wrapper on the destination conversion host.</p>
<p>Squashed commits from review process:</p>
<ul>
<li><p>Rename uci_container_id to uci_container_image.</p></li>
<li><p>Remove flavor and security_groups objects from info.</p></li>
<li><p>Rename ssh_key_path to clarify what it is used for.</p></li>
<li><p>Pass auth parameters straight through to wrapper.</p>
<p>No longer forces password authentication.</p>
</li>
<li><p>Rename server_address module to conversion_host_info.</p></li>
<li><p>Allow specifying conversion hosts with name or ID.</p></li>
<li><p>Include remote wrapper directory in return value.</p>
<p>This helps debug migration failures.</p>
</li>
<li><p>Remove flavor_id from Server’s info_from_sdk.</p></li>
<li><p>Run UCI container with host networking.</p></li>
</ul>
</li>
<li><p>Save ether_type for security group rules. [Jiri Stransky]</p>
<p>This is a fundamental property of the rule, specifies whether the rule
applies to IPv4 or IPv6 traffic.</p>
</li>
<li><p>Adds Router Idempotence Fuctional Test. [Ryan Brady]</p>
<p>This patch adds a test to ensure idempotence for the router resource.</p>
</li>
<li><p>Move instance name from info to params. [Matthew Arnold]</p></li>
<li><p>Basic workload information export. [Matthew Arnold]</p>
<p>Export instance information from a source OpenStack cloud to
workloads.yml. Actual workload migration will require saving more
properties than this, but they will get filled in later.</p>
</li>
<li><p>Allow skipping func test cleanup only after testing. [Jiri Stransky]</p>
<p>Previously it was possible to skip cleanup via <cite>–skip-tags
test_clean</cite>, but that would affect cleanup both before and after
testing. It is now possible to skip the cleanup only after testing,
with <cite>–skip-tags test_clean_after</cite>.</p>
</li>
<li><p>Fix importing router external gateway. [Jiri Stransky]</p>
<p>Previously routers were created without an external gateway interface,
this is now fixed. The interface is created on the network with the
same name as in the source cloud.</p>
</li>
<li><p>Make sure router import/export doesn’t fail if external gateway is not
present. [Jiri Stransky]</p></li>
<li><p>Add a Router import playbook. [Jiri Stransky]</p></li>
<li><p>Force upgrade virtualenv. [Carlos Camacho]</p></li>
<li><p>Galaxy sanity checks. [Carlos Camacho]</p></li>
<li><p>Check build for docs folder. [Carlos Camacho]</p></li>
<li><p>Do not ls, use always current version as latest. [Carlos Camacho]</p></li>
<li><p>Fixes Subnet Update. [Ryan Brady]</p>
<p>Intermittently, the subnet import functional tests fail for ip_version
or network_id attributes.  This patch adds a readonly_params collection
to the Resource class and strips out any readonly properties during an
attempt to update.  For the Subnet resource this patch removes the
blacklisted properties in neutron source for the subnet resource
(project_id, network_id) from the update args.</p>
<p>A follow up issue and series of patches is forthcoming for adding
functional testing for the update on all resources.</p>
<p>closes #142</p>
</li>
<li><p>Document class vars in Resource. [Jiri Stransky]</p></li>
<li><p>Fixes Subnet Update. [Ryan Brady]</p>
<p>Intermittently, the subnet import functional tests fail for ip_version
or network_id attributes.  This patch adds a readonly_params collection
to the Resource class and strips out any readonly properties during an
attempt to update.  For the Subnet resource this patch removes the
blacklisted properties in neutron source for the subnet resource
(project_id, network_id) from the update args.</p>
<p>A follow up issue and series of patches is forthcoming for adding
functional testing for the update on all resources.</p>
<p>closes #142</p>
</li>
<li><p>Update dev docs. [Jiri Stransky]</p>
<p>The dev docs for running functional tests went out of date as we
changed auth mechanism and as we changed how to run a subset of
functional tests. They are now updated to current workflows.</p>
<p>Also slight edit has been made to the design doc now that we’ve made
some implementation decisions where previously there was uncertainty.</p>
</li>
<li><p>Start polishing the Galaxy sanity check to publish the collection.
[Carlos Camacho]</p>
<p>There are several checks we need to pass in order to be able
to publish the collection in both Galaxy and the Automation Hub.</p>
<p>This will be the first change to make it possible.</p>
<p>With this, we can pass the required to publish into galaxy.</p>
</li>
<li><p>OOP security group rules. [Carlos Camacho]</p></li>
<li><p>Move README. [Carlos Camacho]</p></li>
<li><p>Remove old auth mechanism. [Jiri Stransky]</p>
<p>The removal will make sure that we cannot depend on the old
clouds.yaml based auth mechanism and usage of new auth is enforced.</p>
</li>
<li><p>Switch func tests seed/clean/verify to new auth. [Jiri Stransky]</p>
<p>We already have new auth used in all modules, but the func test code
still used the old auth. Switch func tests too.</p>
</li>
<li><p>Switch remaining modules to new auth. [Jiri Stransky]</p>
<p>This swithces the remaining Ansible modules (for routers, router
interfaces, subnets, security groups, security group rules) into using
the new auth mechanism.</p>
</li>
<li><p>Move Network to use transferable auth instead of named clouds. [Jiri
Stransky]</p>
<p>This move Network to use an auth mechanism that we can use also with
Universal Conversion Hosts (something that is easily pushable as data
rather than having to reference a clouds.yaml file).</p>
</li>
<li><p>Script to extract auth info from clouds.yml. [Jiri Stransky]</p>
<p>We’ll need to stop using named clouds because we’ll need to feed
credentials into universal conversion host, we can’t simply copy
user’s clouds.yml there. So let’s start moving towards the other auth
mechanism used - auth + auth_type + region_name. IIUC should still
support advanced mechanisms like Application Credentials, via
different values in auth_type and corresponding auth dictionary.</p>
</li>
<li><p>Fix subnet import idempotence. [Jiri Stransky]</p>
<p>The last param that must be sorted for import idempotence to work is
‘host_routes’. It’s a list of dicts so it needs a list of keys to look
at in each dict. The list-of-dicts sorting is implemented in Resource
class to be reusable.</p>
</li>
<li><p>OOP sec group. [Carlos Camacho]</p></li>
<li><p>Split security groups and rules from networks. [Carlos Camacho]</p></li>
<li><p>Remove Transible code to cleanup the repo structure. [Jiri Stransky]</p>
<p>We’re not using it, and where OS-Migrate is heading now, it doesn’t
seem we will literally need to take parts from it. It can only confuse
folks who try to understand OS-Migrate, making them think that the
code under openstack_ansible directory is being used for the
migration. If we need to revive any of that code, we can find it in
git history.</p>
</li>
<li><p>Add Sagi as a co-author. [Jiri Stransky]</p>
<p>The Transible code from Sagi has been an inspiration for parts of what
we do in OS-Migrate.</p>
</li>
<li><p>Fix Subnet Update. [Ryan Brady]</p>
<p>During the idempotency testing, the subnet update calls to the API
failed for ip_version and network_id.  These parameters are accepted
for the create, but not the update.  Sorting the allocation_pools and
dns_nameservers migtigated the condistion that caused this error.</p>
</li>
<li><p>Lint target needs to make sure the collection is installed. [Jiri
Stransky]</p>
<p>Otherwise it fails with:</p>
<blockquote>
<div><p>Couldn’t parse task at
/root/os_migrate/tests/func/idempotence/security_group.yml:28
(couldn’t resolve module/action
‘os_migrate.os_migrate.os_security_groups_info’. This often
indicates a misspelling, missing collection, or incorrect module
path.</p>
</div></blockquote>
</li>
<li><p>Fixes CI. [Ryan Brady]</p>
<p>The CI started failing today when attempting to run the checkout
source step.  I started researching online and found there is a
race condition issue with the actions/checkout&#64;v1[1].  This patch
changes the checkout action to use &#64;v2 which supposedly addresses
this issue.</p>
<p>[1] <a class="reference external" href="https://github.com/actions/checkout/issues/23">https://github.com/actions/checkout/issues/23</a></p>
</li>
<li><p>Security Group Idempotence Test. [Ryan Brady]</p>
<p>This patch adds idempotence tests for security group import and export.</p>
<p>partially-addresses: #21</p>
</li>
<li><p>Router interfaces import. [Jiri Stransky]</p>
<p>Import interfaces which Routers have in tenant Subnets. This is a more
advanced resource than the basic “CRUD” approach. First we need to
create a port with the desired IP addresses in the desired subnets,
and then we attach those ports to the router. This ensures that the
router interface IP addresses in tenant networks are migrated without
change.</p>
</li>
<li><p>Router interfaces export. [Jiri Stransky]</p>
<p>Export information about interfaces which Routers have in Subnets.</p>
</li>
<li><p>Subnet Idempotence Testing. [Ryan Brady]</p>
<p>This patch adds idempotence test for subnet import and export.</p>
<p>partially-addresses #21</p>
</li>
<li><p>Adds Subnets Import Role. [Ryan Brady]</p>
<p>This patch adds the ability to import subnets from a os_migrate
yaml structure.</p>
</li>
<li><p>Use mysql service instead. [Carlos Camacho]</p></li>
<li><p>Run using the mysql service. [Carlos Camacho]</p></li>
<li><p>Add basic import of Routers. [Jiri Stransky]</p>
<p>Import routers. Some params were refused on the router creation
request so i had to move them to ‘info’.</p>
</li>
<li><p>Refactor router export via Resource subclass. [Jiri Stransky]</p>
<p>The router functionality is just export right now, let’s first
refactor it as Resource subclass before we add import.</p>
</li>
<li><p>Subnets Refactor. [Ryan Brady]</p>
<p>This patch refactors the export subnets role to use the new
Resource class.</p>
</li>
<li><p>Default implementation for Resource.create_or_update. [Jiri Stransky]</p>
<p>By extracting the find/create/update calls for the underlying SDK
object, we can provide a default implementation for the
create_or_update method on Resource. Subclasses can either provide the
find/create/update mini-methods and reuse the create_or_update logic,
or override the create_or_update method fully.</p>
</li>
<li><p>Do not lint YAML files in ./tests/func/tmpdata. [Jiri Stransky]</p>
<p>These resource files are generated in tests via YAML dumper and they
don’t pass the lint check on indentation :).</p>
<p>Also reformat the linters.sh file to make the commands a bit easier to
read.</p>
</li>
<li><p>Remove begining of line. [Carlos Camacho]</p></li>
<li><p>Run ansible-lint last, feed all files into a single process. [Carlos
Camacho, Jiri Stransky]</p>
<p>Ansible-lint is the slowest linter, running it last should speed up
catching Python and YAML lint issues via <cite>test-fast</cite> target.</p>
<p>Also feeding all files into a single ansible-lint process seems to be
much faster than running ansible-lint per file.</p>
</li>
<li><p>Fix YAML nits. [Carlos Camacho]</p></li>
<li><p>Python lint checks. [Carlos Camacho]</p></li>
<li><p>Introduce Resource class. [Jiri Stransky, Ryan Brady]</p>
<p>We created a Resource class as the base class for all our exported
resources. It improves the DRYness of our overall code and is suitable
for both export and import. It uses method composition internally so
that it can be easily “disconnected from network” for purposes of unit
testing.</p>
<p>The common interfaces are now backwards compatible, e.g. the
add_or_replace method for exporting resources now accepts both direct
resource data or an instance of Resource.</p>
</li>
<li><p>Fis bashate. [Carlos Camacho]</p></li>
<li><p>Run Ansible lint. [Carlos Camacho]</p></li>
<li><p>Fix podman’s TTY-related options in vagrant-run. [Jiri Stransky]</p>
<p>The TTY-related options passed to create vs. start are not perfect
substitutes of each other.</p>
<ul class="simple">
<li><p>When calling <cite>start</cite>, we want to always pass <cite>-a</cite> even when not in
interactive shell, simply to avoid launching the container in
background (<cite>podman start</cite> ~= <cite>podman run -d</cite>; <cite>podman start -a</cite> ~=
<cite>podman run</cite>).</p></li>
<li><p>There is no <cite>-t</cite> equivalent for <cite>podman start</cite>. It looks like we
need to decide on allocating pseudo-TTY in <cite>podman create</cite>.</p></li>
<li><p>I’m not 100% sure on the <cite>-i</cite> behavior but from docs it looks like
we either want to pass it to both or neither.</p></li>
</ul>
</li>
<li><p>Allow running functional tests more individually. [Jiri Stransky]</p>
<p>Now one can run this to run only Network tests for example:</p>
<p>./toolbox/run bash -c “FUNC_TEST_ARGS=’–tags test_network’ make test-func”</p>
<p>or Network + Subnet tests:</p>
<p>./toolbox/run bash -c “FUNC_TEST_ARGS=’–tags test_network,test_subnet’ make test-func”</p>
<p>Special new use case is:</p>
<p>./toolbox/run bash -c “FUNC_TEST_ARGS=’–tags test_clean’ make test-func”</p>
<p>which will only clean up the test data from the named clouds.</p>
</li>
<li><p>Implement Router export. [Jiri Stransky]</p>
<p>Note that this doesn’t export router’s interfaces on private subnets,
they will have to be exported/imported via a separate resource.</p>
</li>
<li><p>Write resource correctly when iterating over resources. [Carlos
Camacho]</p>
<p>We are writing only the last item in the array to the output file.</p>
<p>Closes:#100</p>
</li>
<li><p>Import security groups and rules. [Carlos Camacho]</p>
<p>Including unit and functional tests.</p>
</li>
<li><p>Registry.fedoraproject.org consistently fails on pulling images.
[Carlos Camacho]</p>
<p>We had several CI issues related to errors when pulling the
container image from registry.fedoraproject.org</p>
<p>Maybe we wont hit this anymore if we use Docker Hub.
Also, the image shuold be exactly the same.</p>
</li>
<li><p>Include functional tests from exporting security groups and security
group rules. [Carlos Camacho]</p>
<p>We also change the way we query for the security group and rules
before, we were querying the old API which returns a Munch object
instead of the API object we were waiting for.</p>
</li>
<li><p>Correct $HOME ownership in vagrant-run and vagrant-shell. [Jiri
Stransky]</p>
<p>I was considering several options how to solve the issue of incorrect
$HOME ownership in containers:</p>
<ul class="simple">
<li><p>Give the user sudo rights to do the chown in entrypoint. Bad mainly
because we don’t know which user we’ll run as when creating the
container image, and for sudo to work in a container we also need to
mount in /etc/shadow (even when using NOPASSWD sudo).</p></li>
<li><p>Launch the container as root, perform chown in its entrypoint, and
then <cite>su</cite> to another user (we’d pass it in via env variable) to run
the real command. Better than previous but reimplementing the
<cite>–user</cite> argument of <cite>podman run</cite> via an env variable and custom
entrypoint still feels somewhat suboptimal, especially if Vagrant is
not the only use case for the os_migrate_toolbox image.</p></li>
<li><p>First create the container without starting it, tweak the
container’s filesystem as needed via <cite>podman mount</cite>, and then start
the container.</p></li>
</ul>
<p>The last options feels the cleanest and it’s the one implemented in
this commit.</p>
</li>
<li><p>Add validation of unique resource naming. [Jiri Stransky]</p>
<p>This adds validation of resource files. Unique resource naming in
ensured per resource type. Multiple resource files can be fed into the
validation, so if someone had a resource file setup where resources of
the same type are spread across multiple files, the names would still
get validated properly.</p>
<p>Validation can currently be executed in 2 ways:</p>
<ul class="simple">
<li><p>After loading resources, before importing them (can be disabled by a
boolean flag).</p></li>
<li><p>Independently on all resources in a directory via validate_data_dir
playbook.</p></li>
</ul>
</li>
<li><p>Adds Subnet Export. [Ryan Brady]</p>
<p>This patch adds the ability to export subnets from an openstack
cloud into a yaml file.</p>
</li>
<li><p>Use id-based iteration for Security Groups and Security Group Rules.
[Carlos Camacho]</p></li>
<li><p>Including matching id by name for the security group name on rules
param section. [Carlos Camacho]</p>
<p>This commit adds the parameter security_group_name
to the params section.</p>
<p>Closes #79</p>
</li>
<li><p>Update Vagrant-Devstack setup to Fedora 30. [Jiri Stransky]</p>
<p>Fedora 29 is no longer supported.</p>
<p>Closes <a class="reference external" href="https://github.com/os-migrate/os-migrate/issues/74">https://github.com/os-migrate/os-migrate/issues/74</a>
Closes <a class="reference external" href="https://github.com/os-migrate/os-migrate/issues/65">https://github.com/os-migrate/os-migrate/issues/65</a></p>
</li>
<li><p>Adding the export security groups and security group rules. [Carlos
Camacho]</p>
<p>This patch exports the current deployed security
groups into the yaml os-migrate format.</p>
<p>It also export each security group rule per
security group.</p>
</li>
<li><p>Functional CI fixes. [Jiri Stransky]</p>
<p>This moves the container build earlier in the functional CI. There
seem to be flakes recently in the image build, and moving it earlier
in the CI steps should help us fail faster.</p>
<p>Also it makes sure that devstack is ran from /home/stack when it is
ran as stack user. We hit weird ownership issues when running as
<cite>stack</cite> user but devstack is under <cite>/home/runner</cite>.</p>
</li>
<li><p>Assert correct os_migrate_version when loading files. [Jiri Stransky]</p>
<p>Currently we do not guarantee any backward/forward compatibility in
serialized files. Using different version of OS-Migrate between export
and import isn’t supported. Should users get to a situation where
differing versions are needed between export and import, they will
have to investigate the risks and e.g. <cite>sed</cite> the version in files to
the expected one. We’re defaulting to being defensive here.</p>
<p>I was thinking whether this could go into validations as one of the
validation errors, but in fact if the versions are different, we
cannot even guarantee that the validations will work correctly, so
let’s be careful and just raise a clear exception right away.</p>
<p>Closes <a class="reference external" href="https://github.com/os-migrate/os-migrate/issues/20">https://github.com/os-migrate/os-migrate/issues/20</a></p>
</li>
<li><p>Allow duplicate names on export - iterate over resources by ID. [Jiri
Stransky]</p>
<p>We want to export the resources as they are, even if they’d fail
validation e.g. due to duplicate naming. Validation will be performed
on the exported files and/or prior to importing.</p>
<p>This requires an amendment to stringfilter to be able to filter a list
of dicts and not just a simple list of strings. The <cite>attribute</cite>
optional argument is added. This is consistent with behavior of
Ansible’s <cite>sort</cite> filter. By default it operates on flat lists, but
with <cite>attribute</cite> argument it can be made to operate on lists of dicts.</p>
</li>
<li><p>Decide resource sameness on export by ID rather than name. [Jiri
Stransky]</p>
<p>This change is fueled by work on validations. We have essentially 2
options there:</p>
<ul>
<li><p>Export all resources including ones with empty name and duplicate
names. Then run validatiton on the exported files. This requires
that resources are iterated over for export by ID and not by name.</p>
<p>This is nicer because the files can be perhaps edited by hand to
amend the naming on destination cloud without forcing name changes
on source cloud. Validation can be re-ran arbitrarily on the files
to iterate forward.</p>
</li>
<li><p>Validate the state in the source cloud to verify whether export can
be ran, and change the state in the source cloud until unique naming
is achieved. Then run export.</p>
<p>This is less nice because amendments of the source cloud are
necessary before an export can be performed.</p>
</li>
</ul>
<p>To achieve the former (nicer) option, we need to start exporting by
ID. First step, which is done in this commit, is to amend the resource
sameness check which is used during export to figure out if a resource
should be added into a file or if it’s already present.</p>
</li>
<li><p>Do not enable non-existent Copr repo. [Jiri Stransky]</p>
<p>Ian’s copr repo was fixing iSCSI in Fedora but it doesn’t exist
anymore. Let’s just remove it because we don’t need Nova instances
working right now, and we’ll probably be moving onto Fedora 30 or
CentOS 8 subsequently.</p>
</li>
<li><p>Fix prerequisites for Devstack. [Jiri Stransky]</p>
<p>python2 is needed because <cite>/usr/bin/env python</cite> must work, and
python3-pyyaml must be absent.</p>
</li>
<li><p>Better devstack logging. [Jiri Stransky]</p>
<p>Use the LOGFILE variable supported by devstack, instead of <cite>tee</cite>.</p>
</li>
<li><p>Initialize vagrant storage pool in vagrant-destroy if needed. [Jiri
Stransky]</p>
<p>This way you can call ./vagrant-destroy right after starting
vagrant-shell. Previously it would complain that the pool doesn’t
exist. The libvirt session for vagrant is transient and the pool gets
lost every time the container is stopped, but the storage content is
not lost and the pool can simply be recreated on top of the same dir.</p>
</li>
<li><p>Allow local edits in Devstack. [Jiri Stransky]</p>
<p>Now when devstack fails, you can edit files locally and run <cite>vagrant
provision</cite> to retry.</p>
</li>
<li><p>Do not build container with Vagrant in CI. [Jiri Stransky]</p>
<p>We don’t need Vagrant in CI and it pulls a lot of deps, skipping its
installation in CI should speed up the jobs.</p>
</li>
<li><p>Fix checker of resource sameness, add tests for it. [Jiri Stransky]</p>
<p>When two resources have the same type but their names are undefined,
we should not consider them the same. This is now the case after a
copypasta typo is fixed, and tests are added to verify correct
behavior.</p>
</li>
<li><p>Implement generic idempotence checker. [Jiri Stransky]</p>
<p>The resource_needs_update function should be generically usable on all
our resources to check whether some resource is in target state or
needs update (= idempotence checks). It is right away plugged into the
check method for Network.</p>
</li>
<li><p>Simplify and speed up Network functional tests by using name filter.
[Jiri Stransky]</p>
<p>This ensures we only export the network we’re interested in and we
don’t have to hack the resulting file. There is also slight speedup
due to making fewer API calls.</p>
</li>
<li><p>Implement advanced name filtering (exact match, regex) [Jiri Stransky]</p>
<p>This adds a new filter plugin ‘stringfilter’ which allows advanced
conditioning which resources to export, by their name. Either by exact
match or regular expression match, on the names of resources that we
want to export.</p>
</li>
<li><p>Document reusable module_utils functions and network functions. [Jiri
Stransky]</p>
<p>Documents what our functions (especially the reusable ones that are
intended to be shared) should do.</p>
<p>Since Pydoc is a free-form format, i went for very simple way of
describing the functions, trying to maximize the information provided
per characters typed and limit rigid boilerplate. This should help us
be diligent about documenting the functions by making documentation
not much pain to write :).</p>
</li>
<li><p>Adapt conventions based on Security Groups discussion. [Jiri Stransky]</p>
<p>Work on Security Groups spawned a discussion about some
conventions. This patch performs following adaptation:</p>
<ul class="simple">
<li><p>Use ‘_info’ instead of ‘info’ for resource properties which are
irrelevant for importing and idempotence checks. This should further
reduce a chance of conflict with some real property and allow us to
ignore any ‘_info’ <em>also in nested dicts</em> when importing / checking
idempotence.</p></li>
<li><p>Better namespacing for Network type
serialization. ‘openstack.network.Network’ rather than
‘openstack.network’.</p></li>
<li><p>Resource field names for type/params/_info are now constants to
prevent typos.</p></li>
</ul>
</li>
<li><p>Use tab in Makefile. [Jiri Stransky]</p>
<p>This is make’s weirdness, it wants tabs. Here the spaces worked by
accident since they weren’t the beginning of a recipe, rather inside a
bash multi-liner. But it can throw off indentation, so let’s stick to
tabs everywhere.</p>
</li>
<li><p>Initial user documentation. [Jiri Stransky]</p></li>
<li><p>Make sure toolbox container RPMs are up-to-date when building. [Jiri
Stransky]</p>
<p>We install a bunch of (latest) RPMs but until now we didn’t update the
others. This could result in a mixture of RPMs that has never been
tested together in Fedora. Let’s update packages before installing
additional ones.</p>
</li>
<li><p>Remove Tmit PoC build requirements. [Jiri Stransky]</p>
<p>I thought i was pasting just vagrant-libvirt package list but in fact
pasted full Tmit build package list. We don’t need the Rust bits in
OS-Migrate.</p>
<p>GCC needs to be explicitly added because it was an unstated dependency
pulled in by the previous package list.</p>
</li>
<li><p>Use tags in functional tests instead of separate playbooks. [Jiri
Stransky]</p>
<p>To run subset of functional tests, the current pattern was to create a
full playbook which would only include the desired parts.</p>
<p>An alternative pattern might be to use –skip-tags or –tags with the
test_all.yml playbook. This might allow better mix-and-match execution
for particular test environments and developer scenarios.</p>
<p>Due to env vars not being automatically passed into the toolbox
container, currently there are two ways to test this approach e.g. by
skipping the network tests:</p>
<blockquote>
<div><p>./toolbox/shell
FUNC_TEST_ARGS=’–skip-tags test_network’ make test-func</p>
</div></blockquote>
<p>and</p>
<blockquote>
<div><p>./toolbox/run bash -c “FUNC_TEST_ARGS=’–skip-tags test_network’ make test-func”</p>
</div></blockquote>
<p>The 2nd case perhaps deserves some improvement (list of env vars we
want to detect and pass into toolbox container automatically?) but
that’s beyond the scope of this commit.</p>
</li>
<li><p>Split documentation between developer and user parts. [Jiri Stransky]</p></li>
<li><p>Exclude docs from CI. [Carlos Camacho]</p></li>
<li><p>Fix qos_policy ref in Network and remove TODOs. [Jiri Stransky]</p>
<p>Fix a case of copypasta in network_refs_from_ser function.</p>
<p>Remove the TODOs related to the Network refs. Originally i wanted to
load also project_name and subnet_names list, but those are not
necessary for importing under current OS-Migrate assumptions, and
fetching this information in network_refs_from_sdk and
network_refs_from_ser would slow down the import/export with
unnecessary API requests. For now let’s assume this info does not need
to be queried, we can re-evaluatethe decision if we get any hints that
this info would be useful.</p>
</li>
<li><p>Add utility functions for fetching references. [Jiri Stransky]</p></li>
<li><p>References handling for import/export. [Jiri Stransky]</p>
<p>ID-based references to other resources need to be converted to
name-based ones on export, and back to ID-based ones during
import. This is now implemented for Network’s
qos_policy_id/qos_policy_name reference.</p>
<p>The functions which talk to OpenStack API are still kept separate from
functions which only do serialization/deserialization data
mangling. This makes testing and hopefully also reasoning about what
happens where a bit easier.</p>
<p>There’s perhaps still opportunity to extract some of the reference
handling code into a new utility Python module, and add more
references to Network (its Project name and contained Subnet
names). This can be expanded on in another commit.</p>
</li>
<li><p>DRY parameter copying in serialization. [Jiri Stransky]</p>
<p>This DRY code doesn’t reduce line count but it does simplify it
conceptually and is less prone to typos.</p>
</li>
<li><p>Check that what is passed into serialize_network is indeed Network.
[Jiri Stransky]</p></li>
<li><p>Network import idempotence. [Jiri Stransky]</p>
<p>For idempotence of imports we largely have all the pieces, all that
needs to be done is to serialize the existing network into our format
and compare if the resulting ‘params’ are the same as the ones
provided to the import_network module.</p>
<p>Crucial is looking at ‘params’ only and not ‘info’, as ‘params’
contain the important network parameters that are meant to be
migrated, while ‘info’ contains non-migratable info, e.g. the
network’s UUID.</p>
</li>
<li><p>Export idempotence common code, tests, idempotence for Networks. [Jiri
Stransky]</p>
<p>This adds export idempotence common code - when replacing a resource
in a resource YAML file, we first check if indeed anything changed. If
it didn’t, we don’t overwrite that resource and don’t even write into
the file.</p>
<p>This is now utilized for Network resources specifically. Some things
coming from OpenStack API seem to have non-deterministic order,
e.g. the list of networks itself, or list of subnet IDs in a
Network. To make the idempotence work properly, i’ve added sorting
where applicable.</p>
<p>Functional tests which re-execute the export and check that the file
content is the same are added.</p>
</li>
<li><p>Ansible.cfg for func tests - timestamps and nicer output. [Jiri
Stransky]</p>
<p>The profile_tasks callback plugin adds timestamps, allowing us to
check what actions took how long. And YAML log output is generally
easier/faster to read than the non-indented JSON.</p>
</li>
<li><p>Wait until the Devstack fix is merged. [Carlos Camacho]</p>
<p>We need to wait until <a class="reference external" href="https://review.opendev.org/#/c/704136/">https://review.opendev.org/#/c/704136/</a>
is merged to remove the pin.</p>
</li>
<li><p>Design doc - challenges of problem domain and how we deal with them.
[Jiri Stransky]</p>
<p>This is part of the design doc which i forgot to transfer from Tmit
[1]. It is useful to have this rationale captured.</p>
<p>[1] <a class="reference external" href="https://gitlab.com/jistr/tmit/blob/4559f58718f133e8ce44e50f31fef8485ff66fc7/doc/design.md#L107-121">https://gitlab.com/jistr/tmit/blob/4559f58718f133e8ce44e50f31fef8485ff66fc7/doc/design.md#L107-121</a></p>
</li>
<li><p>Make ‘build.sh’ use ‘releases’ dir and make ‘publish.sh’ use
‘build.sh’ [Carlos Camacho]</p></li>
<li><p>Build and publish the collection to Galaxy. [Carlos Camacho]</p>
<p>This patch builds on each merge a new version of the collection,
then this build should be published to Galaxy.</p>
</li>
<li><p>Update version in const.py based on galaxy.yml when building the
collection. [Jiri Stransky]</p>
<p>Initially i wanted to just load the collection manifest from const.py,
but it’s not possible, more details at [1].</p>
<p>Our next best shot is probably to auto-update const.py constant
OS_MIGRATE_VERSION each time we build the collection, which is what
this commit implements.</p>
<p>[1] <a class="reference external" href="https://github.com/os-migrate/os-migrate/pull/28">https://github.com/os-migrate/os-migrate/pull/28</a></p>
<p>Closes #12</p>
</li>
<li><p>Use network class from the .network. openstacksdk submodule. [Jiri
Stransky]</p>
<p>I was initially surprised that the network object from openstacksdk is
inconsistent between creation and fetching, and then i realized that
openstacksdk probably has 2 different Python APIs. The
Connection.get_network() function returns a different object than
Connection.network.find_network().</p>
<p>I’m guessing the API calls directly on Connection are older and we
should probably avoid using them. On brief inspection, the code under
.network. seems better documented and a somewhat nicer API. It is also
the way recommended in the relevant guide:</p>
<p><a class="reference external" href="https://docs.openstack.org/openstacksdk/train/user/guides/network.html">https://docs.openstack.org/openstacksdk/train/user/guides/network.html</a></p>
</li>
<li><p>Resource file reading and networks import. [Jiri Stransky]</p>
<p>The import_networks playbook and role, and import_network module are
for importing networks specifically.</p>
<p>The read_resources module is meant for all importing in general. It
loads the resource YAML file structure into an Ansible variable so
that individual resources can be iterated on inside the roles.</p>
<p>Small deserialization utility functions are added too, for
transforming serialized data into parameters for OpenStack SDK when
creating/updating resources.</p>
<p>There is a block in functional tests that isn’t very nice but it can
be fully removed once we implement name-based filtering on export:</p>
<p><a class="reference external" href="https://github.com/os-migrate/os-migrate/issues/22">https://github.com/os-migrate/os-migrate/issues/22</a></p>
</li>
<li><p>Add minor fixes to unit/functional tests and readme. [Carlos Camacho]</p>
<p>This patch add:</p>
<ul class="simple">
<li><p>Adds a name convention for the tests, currently [unit|functional]-all</p></li>
</ul>
<p>where all should be replaced for the specific type of tests that need
to run, i.e. unit-network or functional-network.</p>
<ul class="simple">
<li><p>Moves the functional tests to run with latest python 3.7.</p></li>
<li><p>Removes unneeded python versions in unit tests.</p></li>
<li><p>Improves the README with links to current tests for merged commmits.</p></li>
<li><p>Add a very initial logo for the project.</p></li>
</ul>
</li>
<li><p>Add serialization basics and network exporting. [Jiri Stransky]</p>
<p>This adds serialization and resource file read/write basics, and adds
rudimentary network exporting.</p>
<p>We may further think whether using some classes for our structures
makes sense, or if just plain dict/list structures are good enough (my
initial approach in this commit). Given that Python is a dynamic
language, we won’t get any compile time validation even if we do add
classes/structures for the data, and any errors will pop up at runtime
either way. This already manifested in dealing with the openstacksdk’s
Network class – even though it’s a class, it didn’t feel like we’re
getting many benefits from it over a plain dict, it is very free-form,
see serialization method in network.py.</p>
</li>
<li><p>Fix filesystem ownership in CI. [Jiri Stransky]</p>
<p>We were hitting weird issues in filesystem ownership [1] which failed
devstack install. Making sure the ownership is correct seems to fix
the problems.</p>
<p>[1] <a class="reference external" href="https://ubuntuforums.org/showthread.php?t=2406453">https://ubuntuforums.org/showthread.php?t=2406453</a></p>
</li>
<li><p>Add CI. [Carlos Camacho]</p></li>
<li><p>Improve documentation. [Carlos Camacho]</p></li>
<li><p>Add a note about Vagrant VM lifespan being tied to vagrant-shell.
[Jiri Stransky]</p></li>
<li><p>Prevent nesting of toolbox commands. [Jiri Stransky]</p></li>
<li><p>Rough draft of workflow on Ansible level. [Jiri Stransky]</p>
<p>This is a very high-level idea of how we might structure the workflow
to give a decent debuggability and hackability of our Ansible-based
tooling.</p>
</li>
<li><p>High-level development goals. [Jiri Stransky]</p>
<p>This list was originally for Tmit PoC (<a class="reference external" href="https://gitlab.com/jistr/tmit">https://gitlab.com/jistr/tmit</a>),
and i think a lot of it could apply for OS-Migrate, so i post it here,
with minor amendments.</p>
</li>
<li><p>Add network serialization stub code. [Jiri Stransky]</p>
<p>The data from serialized network is split between “params” and “info”,
the idea being that params are important values which are needed when
importing the network, while info are not used when importing but
might be useful for a human looking through the exported data.</p>
</li>
<li><p>Call vagrant-up from vagrant-snapshot-revert if needed. [Jiri
Stransky]</p></li>
<li><p>Fix for Fedora 31 vagrant-run. [Jiri Stransky]</p>
<p>It seems that /etc/qemu isn’t required but /dev/net is.</p>
</li>
<li><p>Update toolbox to F31, mount /etc/qemu for Vagrant. [Jiri Stransky]</p></li>
<li><p>Vagrant container - get rid of env vars which are undefined on Fedora
31. [Jiri Stransky]</p></li>
<li><p>Add skeleton for unit and sanity tests. [Jiri Stransky]</p>
<p>This adds Makefile targets “test-sanity”, “test-unit” and a shorthand
target for both, called “test-fast”. The ansible-test tool is used for
sanity and unit testing, and an empty unit test is added to show that
the unit tests run.</p>
</li>
<li><p>Autodetect whether containers run interactively. [Jiri Stransky]</p>
<p>This automatically enables e.g. colored terminal output.</p>
</li>
<li><p>Add a stub of network exporting. [Jiri Stransky]</p>
<p>This is a very rough “i do nothing yet” prototype, but it should give
us something to talk about re structuring the code and tests. It is
exercised from the functional tests already.</p>
</li>
<li><p>Func tests now seed and clean up a network. [Jiri Stransky]</p></li>
<li><p>Clarify functional tests’ clouds.yaml. [Jiri Stransky]</p></li>
<li><p>Remove Vagrant’s clouds.yaml, fix gitignore. [Jiri Stransky]</p></li>
<li><p>Make it possible to run functional tests just for network migration.
[Jiri Stransky]</p></li>
<li><p>Rename test_full to test_all. [Jiri Stransky]</p></li>
<li><p>Document how to run functional tests. [Jiri Stransky]</p></li>
<li><p>Test-func target depends on reinstall. [Jiri Stransky]</p>
<p>Prior to using a collection, it needs to be installed in ~/.ansible in
the toolbox container, so tests should make sure we’ve built and
installed the latest state.</p>
</li>
<li><p>Functional tests skeleton. [Jiri Stransky]</p></li>
<li><p>Add python3-devel to toolbox and openstacksdk to virtualenv. [Jiri
Stransky]</p></li>
<li><p>Make targets for building and installing the collection. [Jiri
Stransky]</p></li>
<li><p>Go for os_migrate namespace right away. [Jiri Stransky]</p>
<p>It seems that the ‘jistr’ namespace might be referenced in may places,
let’s just go for ‘os_migrate’ anticipated namespace right away and
we’ll request it before publishing, or figure out alternatives then.</p>
</li>
<li><p>One more note about naming. [Jiri Stransky]</p></li>
<li><p>Fix capitalization in readme. [Jiri Stransky]</p></li>
<li><p>Document dev env setup steps. [Jiri Stransky]</p></li>
<li><p>Scripts for running vagrant halt and destroy. [Jiri Stransky]</p></li>
<li><p>Add openstack to ansible (transible) converter. [Sagi Shnaidman]</p></li>
<li><p>Add run/shell commands with venv active inside. [Jiri Stransky]</p></li>
<li><p>Interactive editing of toolbox image. [Jiri Stransky]</p></li>
<li><p>Move virtualenv into the container image. [Jiri Stransky]</p></li>
<li><p>Move venv setup into its subdir. [Jiri Stransky]</p></li>
<li><p>Add license file – Apache 2.0. [Jiri Stransky]</p></li>
<li><p>Add vagrantized devstack for running tests against (for now) [Jiri
Stransky]</p>
<p>I guess ideally we’d deploy something more stable like RDO TripleO
Standalone, but i had devstack for now which i’ve written for Tmit
project, so let’s start with that for now.</p>
</li>
<li><p>Generated Ansible collection skeleton. [Jiri Stransky]</p></li>
<li><p>Add virtualenv for locking Python deps. [Jiri Stransky]</p>
<p>Pip install in the virtualenv only works if the toolbox is started
with –security-opt label=disable.</p>
</li>
<li><p>Makefile and a simple toolbox container. [Jiri Stransky]</p></li>
<li><p>Naming convention - underscores rather than hyphens. [Jiri Stransky]</p></li>
<li><p>Init. [Jiri Stransky]</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="modules/module-validate_resource_files.html" class="btn btn-neutral float-left" title="Module - validate_resource_files" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="devel/README.html" class="btn btn-neutral float-right" title="OS Migrate Developer Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, os-migrate.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>