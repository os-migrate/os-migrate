<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Development Environment Setup &mdash; os-migrate  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="General Contribution Guidelines" href="contributing-general.html" />
    <link rel="prev" title="OS Migrate Design" href="design.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> os-migrate
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/README.html">OS Migrate User Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roles.html">Documented roles in os-migrate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Documented modules in os-migrate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="README.html">OS Migrate Developer Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="design.html">OS Migrate Design</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Development Environment Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#development-environment">Development environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sanity-and-unit-tests">Sanity and unit tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vagrant-for-functional-tests">Vagrant for functional tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-functional-tests">Running functional tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-e2e-tests">Running e2e tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#prerequisites-for-e2e-test">Prerequisites for e2e test</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-source-environment-and-destination-environment-projects-and-users">Create source environment and destination environment projects and users</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-images">Create images</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-flavors">Create flavors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-public-network">Create public network</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sample-e2e-config-yaml-using-the-above-prerequisites">Sample e2e config yaml using the above prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-e2e-test-using-the-os-migrate-toolbox-and-the-above-config">Run e2e test using the OS Migrate toolbox and the above config</a></li>
<li class="toctree-l4"><a class="reference internal" href="#expected-output-from-successful-e2e-test-run">Expected output from successful e2e test run</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optional-tags-to-pass-to-e2e-tests">Optional tags to pass to e2e tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optional-playbook-variable">Optional playbook variable</a></li>
<li class="toctree-l4"><a class="reference internal" href="#environment-variables">Environment variables</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="contributing-general.html">General Contribution Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing-code.html">Contributing Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing-docs.html">Contributing Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="releasing.html">Releasing the OS Migrate collection</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev-env-vagrant-non-containerized.html">Installing Vagrant directly on host (alternative path)</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">os-migrate</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="README.html">OS Migrate Developer Documentation</a> &raquo;</li>
      <li>Development Environment Setup</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/devel/dev-env-setup.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="development-environment-setup">
<h1>Development Environment Setup<a class="headerlink" href="#development-environment-setup" title="Permalink to this heading"></a></h1>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Local clone of the os-migrate git repo from
<a class="reference external" href="https://github.com/os-migrate/os-migrate">https://github.com/os-migrate/os-migrate</a></p></li>
<li><p><a class="reference external" href="https://podman.io/">Podman</a> and <a class="reference external" href="https://buildah.io/">Buildah</a>
for running rootless development environment containers.</p></li>
</ul>
</section>
<section id="development-environment">
<h2>Development environment<a class="headerlink" href="#development-environment" title="Permalink to this heading"></a></h2>
<p>Build a container image with tools to be used for building and testing
the project:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">toolbox</span><span class="o">-</span><span class="n">build</span>
</pre></div>
</div>
<p>All further <code class="docutils literal notranslate"><span class="pre">make</span></code> commands etc. should be run from a container
using this image. You can start a bash shell within the development
container like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">toolbox</span><span class="o">/</span><span class="n">run</span>
</pre></div>
</div>
<p>Alternatively, you can run each development-related command in an
ephemeral container using the provided wrapper, if you provide the
command as parameter(s) to the <cite>./toolbox/run</cite> script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">toolbox</span><span class="o">/</span><span class="n">run</span> <span class="n">echo</span> <span class="s2">&quot;Hello from os-migrate toolbox.&quot;</span>
</pre></div>
</div>
</section>
<section id="sanity-and-unit-tests">
<h2>Sanity and unit tests<a class="headerlink" href="#sanity-and-unit-tests" title="Permalink to this heading"></a></h2>
<p>You can run sanity tests this way:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">toolbox</span><span class="o">/</span><span class="n">run</span> <span class="n">make</span> <span class="n">test</span><span class="o">-</span><span class="n">sanity</span>
</pre></div>
</div>
<p>And unit tests this way:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">toolbox</span><span class="o">/</span><span class="n">run</span> <span class="n">make</span> <span class="n">test</span><span class="o">-</span><span class="n">unit</span>
</pre></div>
</div>
<p>To run sanity tests and then unit tests together, a shorthand target
“test-fast” can be used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">toolbox</span><span class="o">/</span><span class="n">run</span> <span class="n">make</span> <span class="n">test</span><span class="o">-</span><span class="n">fast</span>
</pre></div>
</div>
</section>
<section id="vagrant-for-functional-tests">
<h2>Vagrant for functional tests<a class="headerlink" href="#vagrant-for-functional-tests" title="Permalink to this heading"></a></h2>
<p>To run functional tests, you’ll need to connect to OpenStack cloud(s)
where tenant resources can be managed. As a developer, the easiest way
is to run a local virtualized all-in-one OpenStack cloud. OS Migrate has
Vagrant+Devstack setup for this purpose.</p>
<p>If you have Vagrant-libvirt installed on your machine, you can use it
directly, but OS Migrate tooling does not assume that, the customary
way is to run it via the OS Migrate toolbox container. Special
<code class="docutils literal notranslate"><span class="pre">vagrant-run</span></code> wrapper scripts are provided for this purpose.</p>
<p>Note that the Vagrant container cannot run in rootless mode since it
controls libvirt. When the wrapper script is first run, it will copy
the rootless <cite>os-migrate-toolbox</cite> image into the system’s (<cite>root</cite>
user’s) container images automatically.</p>
<p>Launch the Vagrant-capable containerized shell:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">toolbox</span><span class="o">/</span><span class="n">vagrant</span><span class="o">-</span><span class="n">run</span>
</pre></div>
</div>
<p>Within that shell, run the script which brings up Vagrant+Devstack:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># we are already in toolbox/vagrant dir when we launch vagrant-run</span>
<span class="o">./</span><span class="n">vagrant</span><span class="o">-</span><span class="n">up</span>
</pre></div>
</div>
<p>Assuming the creation succeeded, it is now recommended to take a
snapshot of the environment so you can revert it back into a known-good
state later:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">vagrant</span><span class="o">-</span><span class="n">snapshot</span><span class="o">-</span><span class="n">create</span>
</pre></div>
</div>
<p><strong>Important:</strong> the life of the Vagrant VM is tied to the life of the
container started by <code class="docutils literal notranslate"><span class="pre">./toolbox/vagrant-run</span></code>. That means you should
keep the shell open, and run functional tests via <code class="docutils literal notranslate"><span class="pre">./toolbox/run</span> <span class="pre">make</span>
<span class="pre">test-func</span></code> from a different terminal. If you close the
<code class="docutils literal notranslate"><span class="pre">vagrant-run</span></code>, the Vagrant VM will get killed. If that happens, you
can start it again and use <code class="docutils literal notranslate"><span class="pre">./vagrant-snapshot-revert</span></code> to revive
the VM.</p>
<p>If you need to revert the VM at any time, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">vagrant</span><span class="o">-</span><span class="n">snapshot</span><span class="o">-</span><span class="n">revert</span>
</pre></div>
</div>
<p>When you’re done developing, halt Vagrant and close <code class="docutils literal notranslate"><span class="pre">vagrant-run</span></code>
shell:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">vagrant</span><span class="o">-</span><span class="n">halt</span>
<span class="n">exit</span>
</pre></div>
</div>
<p>When you want to develop again, you will be able to reuse the
snapshotted Vagrant environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">toolbox</span><span class="o">/</span><span class="n">vagrant</span><span class="o">-</span><span class="n">run</span>
<span class="o">./</span><span class="n">vagrant</span><span class="o">-</span><span class="n">snapshot</span><span class="o">-</span><span class="n">revert</span>
</pre></div>
</div>
<p>To destroy the Vagrant VM, e.g. when you want to recreate it from
scratch later, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">vagrant</span><span class="o">-</span><span class="n">destroy</span>
</pre></div>
</div>
</section>
<section id="running-functional-tests">
<h2>Running functional tests<a class="headerlink" href="#running-functional-tests" title="Permalink to this heading"></a></h2>
<p>Functional tests expect <code class="docutils literal notranslate"><span class="pre">tests/func/auth_tenant.yml</span></code> and
<code class="docutils literal notranslate"><span class="pre">tests/func/auth_admin.yml</span></code> files to exist and contain
<code class="docutils literal notranslate"><span class="pre">os_migrate_src_auth</span></code> and <code class="docutils literal notranslate"><span class="pre">os_migrate_dst_auth</span></code> variables
with credentials for connecting to OpenStack cloud(s). The tests
will connect to wherever these auth parameters point and
create/delete resources there.</p>
<p>Run a make target which will set up the aforementioned
<code class="docutils literal notranslate"><span class="pre">tests/func/auth_tenant.yml</span></code> file to connect to your
Vagrant+Devstack instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">toolbox</span><span class="o">/</span><span class="n">run</span> <span class="n">make</span> <span class="n">test</span><span class="o">-</span><span class="n">setup</span><span class="o">-</span><span class="n">vagrant</span><span class="o">-</span><span class="n">devstack</span>
</pre></div>
</div>
<p>Run a make target which will set up the aforementioned
<code class="docutils literal notranslate"><span class="pre">tests/func/auth_admin.yml</span></code> file to connect to your
Vagrant+Devstack instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">toolbox</span><span class="o">/</span><span class="n">run</span> <span class="n">make</span> <span class="n">test</span><span class="o">-</span><span class="n">setup</span><span class="o">-</span><span class="n">vagrant</span><span class="o">-</span><span class="n">devstack</span><span class="o">-</span><span class="n">admin</span>
</pre></div>
</div>
<p>Finally, run the functional tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">toolbox</span><span class="o">/</span><span class="n">run</span> <span class="n">make</span> <span class="n">test</span><span class="o">-</span><span class="n">func</span>
</pre></div>
</div>
<p>To run functional tests for just the resource you’re working on, run
e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OS_MIGRATE_FUNC_TEST_ARGS</span><span class="o">=</span><span class="s1">&#39;--tags test_network,test_subnet&#39;</span> <span class="o">./</span><span class="n">toolbox</span><span class="o">/</span><span class="n">run</span> <span class="n">make</span> <span class="n">test</span><span class="o">-</span><span class="n">func</span>
</pre></div>
</div>
<p>To explore imported resources, skip the after-test cleanup of resources,
e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OS_MIGRATE_FUNC_TEST_ARGS</span><span class="o">=</span><span class="s1">&#39;--tags test_network,test_subnet --skip-tags test_clean_after&#39;</span> <span class="o">./</span><span class="n">toolbox</span><span class="o">/</span><span class="n">run</span> <span class="n">make</span> <span class="n">test</span><span class="o">-</span><span class="n">func</span>
</pre></div>
</div>
</section>
<section id="running-e2e-tests">
<h2>Running e2e tests<a class="headerlink" href="#running-e2e-tests" title="Permalink to this heading"></a></h2>
<p>OS Migrate also has a suite of end to end, e2e, tests which tests a migration from one existing openstack deployment
to another existing openstack deployment.</p>
<p>You can also test with a single existing openstack deployment migrating from one project to another.</p>
<p>These docs cover the testing of a single existing openstack deployment migrating from one project to another scenario.</p>
<p>The concepts and prerequisites are the same for other deployments.</p>
<section id="prerequisites-for-e2e-test">
<h3>Prerequisites for e2e test<a class="headerlink" href="#prerequisites-for-e2e-test" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Source environment credentials</p></li>
<li><p>Destination environment credentials</p></li>
<li><p>Existing images in both source and destination environments</p></li>
<li><p>Flavors</p></li>
<li><p>Public network</p></li>
<li><p>Space requirements</p>
<ul>
<li><p>2 images totalling 1.25 GB</p></li>
<li><p>1 volume totalling 1 GB in source environment</p></li>
<li><p>2 volumes totalling 6 GB in destination environment</p></li>
<li><p>2 VMs totalling 35 GB disk usage in each environment</p></li>
</ul>
</li>
</ul>
<p>Below are the steps required to satisfy the above requirements and run e2e tests in a test environment, migrating
resources from one project to another.</p>
</section>
<section id="create-source-environment-and-destination-environment-projects-and-users">
<h3>Create source environment and destination environment projects and users<a class="headerlink" href="#create-source-environment-and-destination-environment-projects-and-users" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the src user in the default domain with password &#39;redhat&#39;</span>
<span class="n">openstack</span> <span class="n">user</span> <span class="n">create</span> <span class="o">--</span><span class="n">domain</span> <span class="n">default</span> <span class="o">--</span><span class="n">password</span> <span class="n">redhat</span> <span class="n">src</span>

<span class="c1"># Create the src project</span>
<span class="n">openstack</span> <span class="n">project</span> <span class="n">create</span> <span class="o">--</span><span class="n">domain</span> <span class="n">default</span> <span class="n">src</span>

<span class="c1"># Assign src user a &#39;member&#39; role in the src project</span>
<span class="n">openstack</span> <span class="n">role</span> <span class="n">add</span> \
<span class="o">--</span><span class="n">user</span> <span class="n">src</span> <span class="o">--</span><span class="n">user</span><span class="o">-</span><span class="n">domain</span> <span class="n">default</span> \
<span class="o">--</span><span class="n">project</span> <span class="n">src</span> <span class="o">--</span><span class="n">project</span><span class="o">-</span><span class="n">domain</span> <span class="n">default</span> <span class="n">member</span>

<span class="c1"># Confirm role assignment was successful</span>
<span class="n">openstack</span> <span class="n">role</span> <span class="n">assignment</span> <span class="nb">list</span> <span class="o">--</span><span class="n">project</span> <span class="n">src</span>

<span class="c1"># Create the dst user in the default domain with password &#39;redhat&#39;</span>
<span class="n">openstack</span> <span class="n">user</span> <span class="n">create</span> <span class="o">--</span><span class="n">domain</span> <span class="n">default</span> <span class="o">--</span><span class="n">password</span> <span class="n">redhat</span> <span class="n">dst</span>

<span class="c1"># Create the dst project</span>
<span class="n">openstack</span> <span class="n">project</span> <span class="n">create</span> <span class="o">--</span><span class="n">domain</span> <span class="n">default</span> <span class="n">dst</span>

<span class="c1"># Assign dst user a &#39;member&#39; role in the src project</span>
<span class="n">openstack</span> <span class="n">role</span> <span class="n">add</span> \
<span class="o">--</span><span class="n">user</span> <span class="n">dst</span> <span class="o">--</span><span class="n">user</span><span class="o">-</span><span class="n">domain</span> <span class="n">default</span> \
<span class="o">--</span><span class="n">project</span> <span class="n">dst</span> <span class="o">--</span><span class="n">project</span><span class="o">-</span><span class="n">domain</span> <span class="n">default</span> <span class="n">member</span>

<span class="c1"># Confirm role assignment was successful</span>
<span class="n">openstack</span> <span class="n">role</span> <span class="n">assignment</span> <span class="nb">list</span> <span class="o">--</span><span class="n">project</span> <span class="n">dst</span>
</pre></div>
</div>
</section>
<section id="create-images">
<h3>Create images<a class="headerlink" href="#create-images" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download images</span>
<span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">cloud</span><span class="o">.</span><span class="n">centos</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">centos</span><span class="o">/</span><span class="mi">8</span><span class="o">-</span><span class="n">stream</span><span class="o">/</span><span class="n">x86_64</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">CentOS</span><span class="o">-</span><span class="n">Stream</span><span class="o">-</span><span class="n">GenericCloud</span><span class="o">-</span><span class="mi">8</span><span class="o">-</span><span class="mf">20220913.0</span><span class="o">.</span><span class="n">x86_64</span><span class="o">.</span><span class="n">qcow2</span>
<span class="n">wget</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">download</span><span class="o">.</span><span class="n">cirros</span><span class="o">-</span><span class="n">cloud</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="mf">0.4.0</span><span class="o">/</span><span class="n">cirros</span><span class="o">-</span><span class="mf">0.4.0</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">disk</span><span class="o">.</span><span class="n">img</span>

<span class="c1"># Create images in glance from these downloads</span>
<span class="n">openstack</span> <span class="n">image</span> <span class="n">create</span> <span class="o">--</span><span class="n">public</span> <span class="o">--</span><span class="n">disk</span><span class="o">-</span><span class="nb">format</span> <span class="n">qcow2</span> <span class="o">--</span><span class="n">file</span> \
    <span class="n">CentOS</span><span class="o">-</span><span class="n">Stream</span><span class="o">-</span><span class="n">GenericCloud</span><span class="o">-</span><span class="mi">8</span><span class="o">-</span><span class="mf">20220913.0</span><span class="o">.</span><span class="n">x86_64</span><span class="o">.</span><span class="n">qcow2</span> <span class="n">CentOS</span><span class="o">-</span><span class="n">Stream</span><span class="o">-</span><span class="n">GenericCloud</span><span class="o">-</span><span class="mi">8</span><span class="o">-</span><span class="mf">20220913.0</span><span class="o">.</span><span class="n">x86_64</span><span class="o">.</span><span class="n">qcow2</span>
<span class="n">openstack</span> <span class="n">image</span> <span class="n">create</span> <span class="o">--</span><span class="n">public</span> <span class="o">--</span><span class="n">disk</span><span class="o">-</span><span class="nb">format</span> <span class="n">raw</span> <span class="o">--</span><span class="n">file</span> <span class="n">cirros</span><span class="o">-</span><span class="mf">0.4.0</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">disk</span><span class="o">.</span><span class="n">img</span> <span class="n">cirros</span><span class="o">-</span><span class="mf">0.4.0</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">disk</span><span class="o">.</span><span class="n">img</span>
</pre></div>
</div>
</section>
<section id="create-flavors">
<h3>Create flavors<a class="headerlink" href="#create-flavors" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">openstack</span> <span class="n">flavor</span> <span class="n">create</span> <span class="o">--</span><span class="n">public</span> \
<span class="o">--</span><span class="n">ram</span> <span class="mi">256</span> <span class="o">--</span><span class="n">disk</span> <span class="mi">5</span> <span class="o">--</span><span class="n">vcpus</span> <span class="mi">1</span> <span class="o">--</span><span class="n">rxtx</span><span class="o">-</span><span class="n">factor</span> <span class="mi">1</span> <span class="n">m1</span><span class="o">.</span><span class="n">xtiny</span>

<span class="n">openstack</span> <span class="n">flavor</span> <span class="n">create</span> <span class="o">--</span><span class="n">public</span> \
<span class="o">--</span><span class="n">ram</span> <span class="mi">2048</span> <span class="o">--</span><span class="n">disk</span> <span class="mi">30</span> <span class="o">--</span><span class="n">vcpus</span> <span class="mi">2</span> <span class="o">--</span><span class="n">rxtx</span><span class="o">-</span><span class="n">factor</span> <span class="mi">1</span> <span class="n">m1</span><span class="o">.</span><span class="n">large</span>
</pre></div>
</div>
</section>
<section id="create-public-network">
<h3>Create public network<a class="headerlink" href="#create-public-network" title="Permalink to this heading"></a></h3>
<p>If your OpenStack environment doesn’t have a public network created
yet, you’ll need to create one. The parameters below should work if
you’re deploying your OpenStack environment with Infrared Virsh
plugin. If you deployed using something else, you may need to adjust
the parameters.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">openstack</span> <span class="n">network</span> <span class="n">create</span> \
     <span class="o">--</span><span class="n">mtu</span> <span class="mi">1500</span> \
     <span class="o">--</span><span class="n">external</span> \
     <span class="o">--</span><span class="n">provider</span><span class="o">-</span><span class="n">network</span><span class="o">-</span><span class="nb">type</span> <span class="n">flat</span> \
     <span class="o">--</span><span class="n">provider</span><span class="o">-</span><span class="n">physical</span><span class="o">-</span><span class="n">network</span> <span class="n">datacentre</span> \
     <span class="n">public</span>

<span class="n">openstack</span> <span class="n">subnet</span> <span class="n">create</span> \
    <span class="o">--</span><span class="n">network</span> <span class="n">public</span> \
    <span class="o">--</span><span class="n">gateway</span> <span class="mf">10.0.0.1</span> \
    <span class="o">--</span><span class="n">subnet</span><span class="o">-</span><span class="nb">range</span> <span class="mf">10.0.0.0</span><span class="o">/</span><span class="mi">24</span> \
    <span class="o">--</span><span class="n">allocation</span><span class="o">-</span><span class="n">pool</span> <span class="n">start</span><span class="o">=</span><span class="mf">10.0.0.150</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="mf">10.0.0.190</span> \
    <span class="n">public</span>
</pre></div>
</div>
</section>
<section id="sample-e2e-config-yaml-using-the-above-prerequisites">
<h3>Sample e2e config yaml using the above prerequisites<a class="headerlink" href="#sample-e2e-config-yaml-using-the-above-prerequisites" title="Permalink to this heading"></a></h3>
<p>Also see <a class="reference external" href="https://github.com/os-migrate/os-migrate/blob/main/tests/e2e/tenant/scenario_variables.yml">https://github.com/os-migrate/os-migrate/blob/main/tests/e2e/tenant/scenario_variables.yml</a></p>
<p>Auth URLs and network names will change based on your environment.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os_migrate_src_auth</span><span class="p">:</span>
  <span class="n">auth_url</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.0.0.131</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">v3</span>
  <span class="n">password</span><span class="p">:</span> <span class="n">redhat</span>
  <span class="n">project_domain_name</span><span class="p">:</span> <span class="n">Default</span>
  <span class="n">project_name</span><span class="p">:</span> <span class="n">src</span>
  <span class="n">user_domain_name</span><span class="p">:</span> <span class="n">Default</span>
  <span class="n">username</span><span class="p">:</span> <span class="n">src</span>
<span class="n">os_migrate_src_region_name</span><span class="p">:</span> <span class="n">regionOne</span>
<span class="n">os_migrate_dst_auth</span><span class="p">:</span>
  <span class="n">auth_url</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.0.0.131</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">v3</span>
  <span class="n">password</span><span class="p">:</span> <span class="n">redhat</span>
  <span class="n">project_domain_name</span><span class="p">:</span> <span class="n">Default</span>
  <span class="n">project_name</span><span class="p">:</span> <span class="n">dst</span>
  <span class="n">user_domain_name</span><span class="p">:</span> <span class="n">Default</span>
  <span class="n">username</span><span class="p">:</span> <span class="n">dst</span>
<span class="n">os_migrate_dst_region_name</span><span class="p">:</span> <span class="n">regionOne</span>

<span class="n">os_migrate_data_dir</span><span class="p">:</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">os_migrate</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">migrate</span><span class="o">-</span><span class="n">data</span>

<span class="n">os_migrate_conversion_host_ssh_user</span><span class="p">:</span> <span class="n">centos</span>
<span class="n">os_migrate_src_conversion_external_network_name</span><span class="p">:</span> <span class="n">nova</span>
<span class="n">os_migrate_dst_conversion_external_network_name</span><span class="p">:</span> <span class="n">nova</span>
<span class="n">os_migrate_conversion_flavor_name</span><span class="p">:</span> <span class="n">m1</span><span class="o">.</span><span class="n">large</span>
<span class="n">os_migrate_conversion_image_name</span><span class="p">:</span> <span class="n">CentOS</span><span class="o">-</span><span class="n">Stream</span><span class="o">-</span><span class="n">GenericCloud</span><span class="o">-</span><span class="mi">8</span><span class="o">-</span><span class="mf">20220913.0</span><span class="o">.</span><span class="n">x86_64</span><span class="o">.</span><span class="n">qcow2</span>

<span class="n">os_migrate_src_osm_server_flavor</span><span class="p">:</span> <span class="n">m1</span><span class="o">.</span><span class="n">xtiny</span>
<span class="n">os_migrate_src_osm_server_image</span><span class="p">:</span> <span class="n">cirros</span><span class="o">-</span><span class="mf">0.4.0</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">disk</span><span class="o">.</span><span class="n">img</span>
<span class="n">os_migrate_src_osm_router_external_network</span><span class="p">:</span> <span class="n">nova</span>

<span class="n">os_migrate_src_validate_certs</span><span class="p">:</span> <span class="kc">False</span>
<span class="n">os_migrate_dst_validate_certs</span><span class="p">:</span> <span class="kc">False</span>

<span class="n">os_migrate_src_release</span><span class="p">:</span> <span class="mi">16</span>
<span class="n">os_migrate_dst_release</span><span class="p">:</span> <span class="mi">16</span>

<span class="n">os_migrate_src_conversion_net_mtu</span><span class="p">:</span> <span class="mi">1400</span>
<span class="n">os_migrate_dst_conversion_net_mtu</span><span class="p">:</span> <span class="mi">1400</span>
</pre></div>
</div>
</section>
<section id="run-e2e-test-using-the-os-migrate-toolbox-and-the-above-config">
<h3>Run e2e test using the OS Migrate toolbox and the above config<a class="headerlink" href="#run-e2e-test-using-the-os-migrate-toolbox-and-the-above-config" title="Permalink to this heading"></a></h3>
<p>Copy the above config to file <cite>custom-config.yaml</cite> in the <cite>local</cite> directory of your local <cite>os-migrate</cite> source.</p>
<p>Run the full test suite using the above config.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OS_MIGRATE_E2E_TEST_ARGS</span><span class="o">=</span><span class="s1">&#39;-e @/root/os_migrate/local/custom-config.yaml&#39;</span> <span class="o">./</span><span class="n">toolbox</span><span class="o">/</span><span class="n">run</span> <span class="n">make</span> <span class="n">test</span><span class="o">-</span><span class="n">e2e</span><span class="o">-</span><span class="n">tenant</span>
</pre></div>
</div>
</section>
<section id="expected-output-from-successful-e2e-test-run">
<h3>Expected output from successful e2e test run<a class="headerlink" href="#expected-output-from-successful-e2e-test-run" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PLAY</span> <span class="n">RECAP</span> <span class="o">********************************************************************************************************</span>
<span class="n">localhost</span>                  <span class="p">:</span> <span class="n">ok</span><span class="o">=</span><span class="mi">318</span>  <span class="n">changed</span><span class="o">=</span><span class="mi">110</span>  <span class="n">unreachable</span><span class="o">=</span><span class="mi">0</span>    <span class="n">failed</span><span class="o">=</span><span class="mi">0</span>    <span class="n">skipped</span><span class="o">=</span><span class="mi">27</span>   <span class="n">rescued</span><span class="o">=</span><span class="mi">0</span>    <span class="n">ignored</span><span class="o">=</span><span class="mi">0</span>
<span class="n">os_migrate_conv_dst</span>        <span class="p">:</span> <span class="n">ok</span><span class="o">=</span><span class="mi">12</span>   <span class="n">changed</span><span class="o">=</span><span class="mi">5</span>    <span class="n">unreachable</span><span class="o">=</span><span class="mi">0</span>    <span class="n">failed</span><span class="o">=</span><span class="mi">0</span>    <span class="n">skipped</span><span class="o">=</span><span class="mi">3</span>    <span class="n">rescued</span><span class="o">=</span><span class="mi">0</span>    <span class="n">ignored</span><span class="o">=</span><span class="mi">0</span>
<span class="n">os_migrate_conv_src</span>        <span class="p">:</span> <span class="n">ok</span><span class="o">=</span><span class="mi">12</span>   <span class="n">changed</span><span class="o">=</span><span class="mi">5</span>    <span class="n">unreachable</span><span class="o">=</span><span class="mi">0</span>    <span class="n">failed</span><span class="o">=</span><span class="mi">0</span>    <span class="n">skipped</span><span class="o">=</span><span class="mi">3</span>    <span class="n">rescued</span><span class="o">=</span><span class="mi">0</span>    <span class="n">ignored</span><span class="o">=</span><span class="mi">0</span>

<span class="n">Wednesday</span> <span class="mi">21</span> <span class="n">July</span> <span class="mi">2021</span>  <span class="mi">09</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">17</span> <span class="o">+</span><span class="mi">0000</span> <span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">03.419</span><span class="p">)</span>       <span class="mi">0</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mf">17.016</span> <span class="o">********</span>
<span class="o">===============================================================================</span>
<span class="n">os_migrate</span><span class="o">.</span><span class="n">os_migrate</span><span class="o">.</span><span class="n">conversion_host_content</span> <span class="p">:</span> <span class="n">update</span> <span class="nb">all</span> <span class="n">packages</span> <span class="o">---------------------------------------</span> <span class="mf">435.56</span><span class="n">s</span>
<span class="n">os_migrate</span><span class="o">.</span><span class="n">os_migrate</span><span class="o">.</span><span class="n">import_workloads</span> <span class="p">:</span> <span class="n">transfer</span> <span class="n">volumes</span> <span class="n">to</span> <span class="n">destination</span> <span class="o">----------------------------------</span> <span class="mf">101.72</span><span class="n">s</span>
<span class="n">os_migrate</span><span class="o">.</span><span class="n">os_migrate</span><span class="o">.</span><span class="n">import_workloads</span> <span class="p">:</span> <span class="n">expose</span> <span class="n">source</span> <span class="n">volumes</span> <span class="o">---------------------------------------------</span> <span class="mf">66.67</span><span class="n">s</span>
<span class="n">os_migrate</span><span class="o">.</span><span class="n">os_migrate</span><span class="o">.</span><span class="n">conversion_host_content</span> <span class="p">:</span> <span class="n">install</span> <span class="n">content</span> <span class="o">--------------------------------------------</span> <span class="mf">62.35</span><span class="n">s</span>
<span class="n">os_migrate</span><span class="o">.</span><span class="n">os_migrate</span><span class="o">.</span><span class="n">import_workloads</span> <span class="p">:</span> <span class="n">transfer</span> <span class="n">volumes</span> <span class="n">to</span> <span class="n">destination</span> <span class="o">-----------------------------------</span> <span class="mf">58.75</span><span class="n">s</span>
<span class="n">os_migrate</span><span class="o">.</span><span class="n">os_migrate</span><span class="o">.</span><span class="n">import_workloads</span> <span class="p">:</span> <span class="n">clean</span> <span class="n">up</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">source</span> <span class="n">cloud</span> <span class="n">after</span> <span class="n">migration</span> <span class="o">----------------------</span> <span class="mf">27.40</span><span class="n">s</span>
<span class="n">os_migrate</span><span class="o">.</span><span class="n">os_migrate</span><span class="o">.</span><span class="n">import_workloads</span> <span class="p">:</span> <span class="n">expose</span> <span class="n">source</span> <span class="n">volumes</span> <span class="o">---------------------------------------------</span> <span class="mf">27.30</span><span class="n">s</span>
<span class="n">Create</span> <span class="n">osm_server</span> <span class="o">------------------------------------------------------------------------------------------</span> <span class="mf">24.71</span><span class="n">s</span>
<span class="n">create</span> <span class="n">osm_image</span> <span class="o">-------------------------------------------------------------------------------------------</span> <span class="mf">23.86</span><span class="n">s</span>
<span class="n">os_migrate</span><span class="o">.</span><span class="n">os_migrate</span><span class="o">.</span><span class="n">export_images</span> <span class="p">:</span> <span class="n">export</span> <span class="n">image</span> <span class="n">blobs</span> <span class="o">---------------------------------------------------</span> <span class="mf">23.80</span><span class="n">s</span>
<span class="n">os_migrate</span><span class="o">.</span><span class="n">os_migrate</span><span class="o">.</span><span class="n">import_images</span> <span class="p">:</span> <span class="kn">import</span> <span class="nn">images</span> <span class="o">--------------------------------------------------------</span> <span class="mf">23.69</span><span class="n">s</span>
<span class="n">os_migrate</span><span class="o">.</span><span class="n">os_migrate</span><span class="o">.</span><span class="n">import_workloads</span> <span class="p">:</span> <span class="n">create</span> <span class="n">destination</span> <span class="n">instance</span> <span class="o">---------------------------------------</span> <span class="mf">23.30</span><span class="n">s</span>
<span class="n">os_migrate</span><span class="o">.</span><span class="n">os_migrate</span><span class="o">.</span><span class="n">import_workloads</span> <span class="p">:</span> <span class="n">create</span> <span class="n">destination</span> <span class="n">instance</span> <span class="o">---------------------------------------</span> <span class="mf">21.93</span><span class="n">s</span>
<span class="n">Create</span> <span class="n">osm_server</span> <span class="o">------------------------------------------------------------------------------------------</span> <span class="mf">21.61</span><span class="n">s</span>
<span class="n">os_migrate</span><span class="o">.</span><span class="n">os_migrate</span><span class="o">.</span><span class="n">import_workloads</span> <span class="p">:</span> <span class="n">clean</span> <span class="n">up</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">source</span> <span class="n">cloud</span> <span class="n">after</span> <span class="n">migration</span> <span class="o">----------------------</span> <span class="mf">21.16</span><span class="n">s</span>
<span class="n">os_migrate</span><span class="o">.</span><span class="n">os_migrate</span><span class="o">.</span><span class="n">conversion_host</span> <span class="p">:</span> <span class="n">create</span> <span class="n">os_migrate</span> <span class="n">conversion</span> <span class="n">host</span> <span class="o">----------------------------------</span> <span class="mf">20.03</span><span class="n">s</span>
<span class="n">Remove</span> <span class="n">osm_server</span> <span class="o">------------------------------------------------------------------------------------------</span> <span class="mf">19.01</span><span class="n">s</span>
<span class="n">os_migrate</span><span class="o">.</span><span class="n">os_migrate</span><span class="o">.</span><span class="n">conversion_host</span> <span class="p">:</span> <span class="n">create</span> <span class="n">os_migrate</span> <span class="n">conversion</span> <span class="n">host</span> <span class="o">----------------------------------</span> <span class="mf">18.23</span><span class="n">s</span>
<span class="n">Shutdown</span> <span class="n">osm_server</span> <span class="o">----------------------------------------------------------------------------------------</span> <span class="mf">18.14</span><span class="n">s</span>
<span class="n">Shutdown</span> <span class="n">osm_server</span> <span class="o">----------------------------------------------------------------------------------------</span> <span class="mf">17.88</span><span class="n">s</span>
</pre></div>
</div>
</section>
<section id="optional-tags-to-pass-to-e2e-tests">
<h3>Optional tags to pass to e2e tests<a class="headerlink" href="#optional-tags-to-pass-to-e2e-tests" title="Permalink to this heading"></a></h3>
<p>There are a set of tags that can be used to filter which tasks to run during test.</p>
<ul class="simple">
<li><p>test_clean_before</p></li>
<li><p>test_workload</p></li>
<li><p>test_image_workload_boot_copy</p></li>
<li><p>test_image_workload_boot_nocopy</p></li>
<li><p>test_image_workload_boot_copy_clean</p></li>
<li><p>test_clean_before</p></li>
<li><p>test_pre_workload</p></li>
</ul>
</section>
<section id="optional-playbook-variable">
<h3>Optional playbook variable<a class="headerlink" href="#optional-playbook-variable" title="Permalink to this heading"></a></h3>
<p>There is also an optional variable <cite>test_clean_conversion_hosts_after</cite> which can be set to <cite>false</cite> if you do not wish
to clean up conversion hosts after test is complete.</p>
</section>
<section id="environment-variables">
<h3>Environment variables<a class="headerlink" href="#environment-variables" title="Permalink to this heading"></a></h3>
<p>The following environment variables can be used when running e2e tests.</p>
<ul>
<li><p><cite>OS_MIGRATE_E2E_TEST_ARGS</cite>: All of the above tags and playbook variables can be set using the
<cite>OS_MIGRATE_E2E_TEST_ARGS</cite> environment variable. This variable is also used to pass in the playbook custom config
file. eg:</p>
<blockquote>
<div><p><cite>OS_MIGRATE_E2E_TEST_ARGS=’-e &#64;/root/os_migrate/local/custom-config.yaml –tags test_clean_before,test_workload –skip-tags test_clean_after -e test_clean_conversion_hosts_after=false’</cite></p>
</div></blockquote>
</li>
<li><p><cite>ROOT_DIR</cite>: Absolute directory path to OS Migrate source. When not set the default when run using OS Migrate developer
toolbox this is set to <cite>/root/os_migrate</cite>.</p></li>
<li><p><cite>OS_MIGRATE</cite>: Absolute directory path to the OS Migrate ansible collection. When not set the default when run using
os-migrate developer toolbox this is set to <cite>/root/.ansible/collections/ansible_collections/os_migrate/os_migrate</cite>.</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="design.html" class="btn btn-neutral float-left" title="OS Migrate Design" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="contributing-general.html" class="btn btn-neutral float-right" title="General Contribution Guidelines" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, os-migrate.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>